<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Git Konus Uygulamasi</title>
  
<style>


 
#splash {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  background: #5458a6;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  transition: opacity 1s ease, visibility 1s ease;
  overflow: hidden;
}

#splash.hidden {
  opacity: 0;
  visibility: hidden;
}

#splash .logo-container {
  text-align: center;
  max-width: 90%;
  will-change: transform;
  animation: pop 1s ease-out forwards;
}

#splash img {
  width: 40vw;
  max-width: 160px;
  height: auto;
  display: block;
  margin: 0 auto;
}

#splash .app-name {
  margin-top: 15px;
  font-size: clamp(16px, 5vw, 22px);
  font-weight: bold;
  color: #fff;
  text-align: center;
}


/* Bounce animation on wrapper */
@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

/* Bounce text (smaller movement) */
@keyframes bounce-text {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}
@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.2); opacity: 0.7; }
  100% { transform: scale(1); opacity: 1; }
}
  
@keyframes glow {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; }
}
  
@keyframes pop {
  0% { transform: scale(3); opacity: 0; }
  60% { transform: scale(1.7); opacity: 1; }
  100% { transform: scale(2); }
}


  
body { font-family: Georgia, serif; margin: 0; padding: 0; padding-top: 80px; background: #5458a6; color: #fff; }

#tinyTopLeft {
  color: transparent;      /* Makes text invisible */
  pointer-events: none;    /* Optional: prevents clicking on it */
}

/* Step Progress Bar */
.step-progress-line {
  position: absolute;
  bottom: 27px; /* aligns with step dots */
  left: 0;
  height: 5px;
  background: linear-gradient(90deg, #ffd83a, #ffc700);
  width: 0%;
  z-index: -1;
  transition: width 1s ease-in-out;
  border-radius: 3px;
}
.step-progress-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: #4247a6;
  padding: 0px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 2000;
  font-weight: bold;
  font-family: Georgia, serif;
}
.step-progress-container-inner {
  position: relative;
  align-items: center;
  width: 100%;
  height: 120px;
  display: flex;
  justify-content: space-between;
  left: 0px;
  margin: 0 auto; 
}

.step-progress-container-inner .bottom-text {
  position: absolute;
  bottom: 0;            /* stick to bottom */
  left: 0;              /* align to left */
  text-align: left;      /* left-align text */
  color: #fff;           /* white text */
  font-size: 1rem;     /* bigger, relative size */
  padding-left: 1rem;    /* spacing from left */
  padding-bottom: 0.3rem;/* spacing from bottom */
  font-weight: normal;    /* not bold */
}

#stepBeginner { left: 0%; }
#stepBronze   { left: 25%; }
#stepSilver   { left: 50%; }
#stepGold     { left: 85%; }

.step-progress-step {
  position: absolute;
  top: 0;
  transform: translateX(-50%); /* center alignment */
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 46px;
  color: #8c90d0;
  opacity: 0.4;       /* dim by default */
  transition: opacity 0.3s, color 0.3s;
}

.step-progress-step:not(:last-child)::after {
  content: '';
  position: absolute;
  top: 12px;
  right: -50%;
  width: 100%;
  height: 0px;
  background: #ddd;
  z-index: -1;
}

.step-progress-step.completed {
  color: #28a745;
  opacity: 1;          /* fully visible when completed */
}

.step-progress-step.completed:not(:last-child)::after {
  background: linear-gradient(to right, #cd7f32, #c0c0c0, #ffd700, #e5e4e2);
}

.step-progress-step span {
  margin-top: 6px;
  font-size: 0.8em;
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-15px); }
  60% { transform: translateY(-8px); }
}

.step-progress-step.bounce {
  animation: bounce 0.6s;
}

#assessmentPopup {
  opacity: 0;
  transform: scale(0.9);
  transition: opacity 0.8s ease, transform 0.8s ease;
background: transparent !important; /* Remove black background */
  pointer-events: none; /* Allow clicks to pass through when not visible */
}

#assessmentPopup.show {
  opacity: 1;
  transform: scale(1);
  pointer-events: auto; /* Enable clicks when visible */
}

#assessmentPopup .popup-content {
  background: white; /* Ensure content has white background */
  box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* Add shadow for depth */
  pointer-events: auto; /* Ensure content is clickable */
}
  
/* Gradient wipe overlay */
.gradient-wipe {
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0) 100%);
  pointer-events: none;
  animation: wipe 2s ease forwards;
  border-radius: 12px; /* match lesson card border-radius */
}

@keyframes wipe {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.youtube-app-btn:hover {
  background: #ff0000;
  transform: scale(1.15);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
}
.share-option-btn {
  background: #f8f9fa;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  padding: 12px;
  cursor: pointer;
  text-align: left;
  font-family: Georgia, serif;
  font-size: 1em;
  color: #495057;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
}

.share-option-btn:hover {
  background: #e9ecef;
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* NEW STYLES FOR BEN KIMIM POPUP */
#benKimimPopup .popup-content {
  background: white;
  padding: 10px;
  border-radius: 12px;
  max-width: 500px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  max-height: 85vh; /* Limit height for mobile */
  display: flex;
  flex-direction: column;
}

.benkimim-title {
  font-size: 1.5em;
  color: #5458a6;
  margin-bottom: 10px;
  font-weight: bold;
  font-family: Georgia, serif;
  flex-shrink: 0; /* Prevent title from shrinking */
}

.benkimim-scrollable-content {
  max-height: calc(85vh - 180px); /* Calculate available space */
  overflow-y: auto;
  margin-bottom: 15px;
  padding-right: 5px;
}

.benkimim-close-btn {
  background: #5458a6;
  color: white;
  padding: 12px 30px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-family: Georgia, serif;
  font-size: 1.1em;
  transition: background 0.3s;
  flex-shrink: 0; /* Prevent button from shrinking */
  margin-top: auto; /* Push button to bottom */
}

.benkimim-close-btn:hover {
  background: #4247a6;
  transform: scale(1.05);
}

/* Ensure proper popup positioning on mobile */
@media (max-height: 700px) {
  #benKimimPopup .popup-content {
    max-height: 90vh;
    padding: 20px;
  }
  
  .benkimim-scrollable-content {
    max-height: calc(90vh - 160px);
  }
  
  .benkimim-title {
    font-size: 1.5em;
    margin-bottom: 10px;
  }
}

@keyframes pulseCelebration {
  0% { 
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
  }
  50% { 
    transform: scale(1.05);
    box-shadow: 0 0 0 20px rgba(40, 167, 69, 0);
  }
  100% { 
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
  }
}

#evalBtn.permanent {
  box-shadow: 0 0 15px rgba(212, 156, 2, 0.7);
  border: 2px solid #fff;
  animation: subtlePulse 3s infinite ease-in-out;
}
/* Adjust container padding for top fixed bar */
.container { max-width: 700px; margin: 0px auto 60px; padding: 15px; }

.lesson { margin-bottom: 20px; padding: 15px; border-radius: 8px; color: #000; display: flex; flex-direction: column; scroll-margin-top: 36px; position: relative; }
.lesson-title { font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; font-size: 1.4em; }
.lesson-title img { width: 120px; height: 70px; border-radius: 6px; object-fit: cover; flex-shrink: 0; cursor: pointer; }
.checkmark { position: absolute; top: 2px; right: 2px; background: #28a745; color: #fff; border-radius: 50%; width: 32px; height: 32px; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 20px; z-index: 10; box-shadow: 0 0 6px rgba(0,0,0,0.5); transform: scale(0); animation: popIn 0.5s forwards; }
@keyframes popIn { 0% { transform: scale(0); } 60% { transform: scale(1.3); } 100% { transform: scale(1); } }

.video-wrapper { position: relative; width: 290px; height: 160px; overflow: hidden; border-radius: 12px; margin-top: 5px; margin-left: 15px;}
.video-thumb { width: 100%; height: 100%; object-fit: cover; object-position: center; border-radius: 6px; cursor: pointer; }
.play-btn {position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 50px;
  height: 40px;
  background: rgba(255, 0, 0, 0.9);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(4px);
}
.play-btn::before {
  content: '';
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 8px 0 8px 16px;
  border-color: transparent transparent transparent white;
  margin-left: 3px;
}

.play-btn:hover {
  background: rgba(255, 0, 0, 0.9);
  transform: translate(-50%, -50%) scale(1.1);
}
.done-btn { background-color: #28a745; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; color: #fff; margin-top: 10px; align-self: flex-end; font-size: 1.2em; transition: transform 0.2s, background 0.3s; }
.done-btn:hover { background-color: #1f7f35; transform: scale(1.05); }

.popup, .confirm-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; z-index: 2000; opacity: 0; transform: scale(0.8); transition: opacity 0.3s ease, transform 0.3s ease; }
.popup.show, .confirm-popup.show { opacity: 1; transform: scale(1); }
.popup { background: rgba(0,0,0,0.6); }
.popup-content { background: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; display: flex; flex-direction: column; color: #000; box-shadow: 0 10px 30px rgba(0,0,0,0.3); padding-top: 10;
  margin-top: 0; }
textarea { width: 100%; height: 160px; margin-bottom: 10px; resize: none; font-size: 1.1em; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
.popup-message { color: red; font-weight: bold; text-align: center; margin-bottom: 10px; display: none; }

button { transition: all 0.2s ease; border-radius: 8px; font-weight: bold; cursor: pointer; }
button:hover { transform: scale(1.05); }

.confirm-popup { background: rgba(0,0,0,0.5); }
.confirm-content { background: #fff; color: #000; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; text-align: center; display: flex; flex-direction: column; gap: 15px; font-family: Georgia, serif;}
.confirm-buttons { display: flex; justify-content: space-around; font-family: Georgia, serif;}
.confirm-buttons button { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: transform 0.2s; font-family: Georgia, serif;}
.confirm-buttons button:hover { transform: scale(1.05); font-family: Georgia, serif;}
.confirm-buttons .yes { background: #28a745; color: #fff; font-family: Georgia, serif;}
.confirm-buttons .no { background: #dc3545; color: #fff; font-family: Georgia, serif;}

#videoPopup .popup-content { background: none; box-shadow: none; padding: 0; border: none; max-width: 800px; width: 95%; font-family: Georgia, serif;}


.popup, .confirm-popup {
  z-index: 4000; /* Base z-index for all popups */
}

.confirm-popup {
  z-index: 5000; /* Confirm popups should be on top */
}

#assessmentPopup {
  z-index: 4000; /* Assessment popup stays below confirm */
}

/* Ensure popup backgrounds don't block each other */
.popup.show, .confirm-popup.show {
  z-index: 5000; /* When shown, confirm should be on top */
}

#assessmentPopup.show {
  z-index: 4000; /* Assessment should stay below when shown */
}
.top-controls {
  position: fixed;
  top: 100px; 
  right: 20px;
  z-index: 3000;
}
.menu-item { padding: 8px 15px; cursor: pointer; border-radius: 8px; transition: background 0.3s; }
.menu-item:hover { background: #ddd; }

.word-progress { height: 12px; border-radius: 6px; background: #ddd; margin-bottom: 10px; overflow: hidden; }
.word-progress-bar { height: 100%; width: 0%; background: linear-gradient(to right, #28a745, #85e085); transition: width 0.2s; }

@keyframes tremble {
  0% { transform: rotate(0deg); }
  25% { transform: rotate(2deg); }
  50% { transform: rotate(0deg); }
  75% { transform: rotate(-2deg); }
  100% { transform: rotate(0deg); }
}

.tremble {
  animation: tremble 0.5s ease-in-out infinite;
}

@keyframes newLessonHighlight {
  0% { background-color: #ffff99; transform: scale(1.02); }
  50% { background-color: #fdd607; transform: scale(1); } /* Use yellow instead of blue */
  100% { background-color: #fdd607; transform: scale(1); } /* End on yellow */
}

.app-title-above-lessons {
  text-align: right;
  padding: 23px 30px 5px 20px;
  margin-top: 0;
}

.app-main-title {
  color: #fff;
  font-size: 1.8em;
  font-weight: bold;
  margin: 0;
  
  font-family: Georgia, serif;
}

.new-lesson {
  animation: newLessonHighlight 1.2s ease forwards;
}
#assessmentPopup .popup-content {
  display: flex;
  flex-direction: column;
  max-height: 80vh;
  height: 80vh;
  padding: 0;
  overflow: hidden;
}

.assessment-image-container {
  flex-shrink: 0;
  width: 100%;
  max-height: 200px;
  overflow: hidden;
}

.assessment-image-container img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.assessment-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.assessment-buttons {
  flex-shrink: 0;
  padding: 15px;
  border-top: 1px solid #eee;
  display: flex;
  justify-content: center;
}

/* skipped lesson thumbnail play button */
.skipped-lesson-play-btn {
  position: absolute;
  bottom: 8px;
  right: 8px;
  background: #ff4444;
  color: white;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 12px;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  z-index: 5;
}

.skipped-lesson-play-btn:hover {
  background: #ff0000;
  transform: scale(1.1);
}

.vertical-gallery {
  display: flex;
  flex-direction: column;
  gap: 15px;           /* space between images */
  margin-top: 20px;
}

.vertical-gallery img {
  width: 100%;
  max-width: 350px;    /* control size */
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  margin: 0 auto;      /* center images */
}

/* Ask Orkun Popup Enhanced Styles */
#askOrkunPopup .popup-content {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  max-height: 90vh;
  overflow-y: auto;
}

#askOrkunPopup label {
  font-family: Georgia, serif;
  color: #333;
}

#askOrkunPopup input[type="text"],
#askOrkunPopup input[type="number"] {
  font-family: Georgia, serif;
  font-size: 1em;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 6px;
  transition: border-color 0.3s;
}

#askOrkunPopup input[type="text"]:focus,
#askOrkunPopup input[type="number"]:focus {
  border-color: #5458a6;
  outline: none;
}

#askOrkunPopup input[type="radio"] {
  margin-right: 5px;
}

#askOrkunText {
  font-family: Georgia, serif;
  font-size: 1em;
  line-height: 1.5;
}

#askOrkunSend:hover {
  background: #1f7f35 !important;
}

#askOrkunCancel:hover {
  background: #c82333 !important;
}
.novel-style {
  font-family: "Georgia", serif;
  font-size: 1.3em;
  line-height: 1.8;
  background: #fdfcf7;
  color: #2c2c2c;
  max-width: 600px;
  padding: 40px;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  text-align: left;
  white-space: pre-wrap;
}
#editNoteBtn:hover {
  text-decoration: underline;
}

.menu-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  font-size: 2.2em; /* Larger three-dot icon */
  padding: 15px; /* Larger tap area */
  color: #fff;
  cursor: pointer;
  border-radius: 8px;
  background: #5458a6; /* Matches app theme */
  z-index: 1700; /* Above other elements */
}

#menuDropdown {
  position: absolute;
  top: 60px; /* Adjusted for larger menu-btn */
  right: 0;
  min-width: 220px; /* Increased from 180px */
  background: #fff;
  color: #000;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  z-index: 1600;
  display: none;
  flex-direction: column;
  padding: 10px 0; /* Increased from 5px 0 */
}

.menu-item {
  padding: 12px 15px; /* Larger padding for touchability */
  font-size: 1.2em; /* Larger text */
  color: #5458a6;
  cursor: pointer;
  font-family: Georgia, serif;
  border-bottom: 1px solid #eee;
}

.menu-item:last-child {
  border-bottom: none;
}

.menu-item:hover {
  background: #f0f0f0; /* Hover effect for clarity */
}

/* About Me Popup */
#aboutPopup .popup-content {
  max-width: 500px;
  padding: 25px;
  text-align: center;
}

.about-title {
  font-size: 1.5em;
  color: #5458a6;
  margin-bottom: 15px;
  font-weight: bold;
}

.about-text {
  font-size: 1.1em;
  line-height: 1.6;
  color: #333;
  margin-bottom: 20px;
  font-family: Georgia, serif;
}

.about-close-btn {
  background: #5458a6;
  color: white;
  padding: 10px 25px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-family: Georgia, serif;
  font-size: 1em;
  transition: background 0.3s;
}

.about-close-btn:hover {
  background: #4247a6;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const CORRECT_PASSWORD = "2025"; // 🔑 Change this
  const STORAGE_KEY = "page_unlocked";
  const modal = document.getElementById("passwordModal");
  const input = document.getElementById("passwordInput");
  const btn = document.getElementById("submitPassword");
  const error = document.getElementById("errorMsg");

  // Show modal if not unlocked
  if (localStorage.getItem(STORAGE_KEY) !== "true") {
    modal.style.display = "flex";
  } else {
    modal.style.display = "none";
  }

  btn.addEventListener("click", function () {
    if (input.value === CORRECT_PASSWORD) {
      localStorage.setItem(STORAGE_KEY, "true");
      modal.style.display = "none";
    } else {
      error.style.display = "block";
    }
  });
});
</script>


</head>
<body>
<div id="splash">
  <div class="logo-container">
    <img src="0002a.jpg" alt="Logo">
    <div class="app-name"></div>
  </div>
</div>

<!-- Main App -->
<div id="tinyTopLeft" style="display:block;">Videoyu izle ve ilk göreve başla</div>

<div class="step-progress-container">
  <div class="step-progress-container-inner">
    <div class="bottom-text">🔔 Ayağa kalkman kalan görev sayısı: 14</div>
    <div class="step-progress-line" id="progressLine"></div>
    <div class="step-progress-step" id="stepBeginner">
      <img src="0001.png" width="85">
    </div>
    <div class="step-progress-step" id="stepBronze">
      <img src="0002.png" width="85">
    </div>
    <div class="step-progress-step" id="stepSilver">
      <img src="0003.png" width="85">
    </div>
    <div class="step-progress-step" id="stepGold">
      <img src="0004.png" width="85">
    </div>
  </div>
</div>
  

<div class="top-row controls-row">
<div class="top-controls" id="menuBtn">
  ⋮
  <div id="menuDropdown" style="display:none; position:absolute; top:60px; right:0; background:#fff; color:#000; border-radius:6px; box-shadow:0 2px 8px rgba(0,0,0,0.3); min-width:220px; z-index:1600; flex-direction:column; padding:10px 0;">
    <div class="menu-item" id="resetLessons">Görevleri Sıfırla</div>
    <div class="menu-item" id="copyNotesBtn">Notları Kopyala!</div>
    <div class="menu-item" id="benKimimBtn">Ben Kimim?</div>

  </div>
</div>
</div>

<div class="app-title-above-lessons">
  <img src="LOGO.png" alt="logo" style="width: 200px;">
</div>
<div class="container" id="app"></div>

<!-- Two-option popup -->
<div class="popup" id="popup">
  <div class="popup-content">
    <button id="completeLesson" style="background:#28a745; color:#fff; padding:15px; border:none; font-size:1.2em; margin-bottom:10px; font-family: Georgia, serif;">
      Görevi Başardım!
    </button>
    <button id="skipLessonBtn" style="background:#aaa; color:#000; padding:15px; border:none; font-size:1.2em; font-family: Georgia, serif;">
      Görevi Atlayacağım!
    </button>
  </div>
</div>

<!-- Note-taking popup -->
<div class="popup" id="notePopup">
  <div class="popup-content novel-style" style="display:flex; flex-direction:column; max-height:50vh;">
    <!-- Header -->
    <div id="notePopupHeader" 
         style="font-family: Georgia, serif; font-weight:bold; font-size:18px; text-align:top; margin-bottom:10px;">
      Not Alma
    </div>
    <div class="word-progress"><div class="word-progress-bar" id="wordProgress"></div></div>  
    <div id="noteMessage" contenteditable="true" spellcheck="true" 
         style="flex:1; overflow-y:auto; padding-right:5px; font-family: Georgia, serif; font-size:12px; color:green;"></div>
    <textarea id="noteInput" placeholder="Bu görev hakkında en az 10 kelime yaz..." style="width: 100%; min-height: 100px; padding: 10px; font-family: Georgia, serif;"></textarea>
    <div style="display:flex; justify-content:space-between; font-family: Georgia, serif; margin-bottom:0; padding-bottom:0;">
      <button id="saveNote" style="background:#28a745; color:#fff; padding:10px; border:none; font-family: Georgia, serif;">Notu Kaydet</button>
      <button id="cancelNote" style="background:#aaa; color:#000; padding:10px; border:none; font-family: Georgia, serif;">İptal</button>
    </div>
  </div>
</div>

<div class="confirm-popup" id="confirmPopup">
  <div class="confirm-content" style="font-family: Georgia, serif; font-size:1.2500em;">
    <div id="confirmText">Uyarı!</div>
    <div class="confirm-buttons">
      <button class="yes" id="confirmYes">Evet</button>
      <button class="no" id="confirmNo">Hayır</button>
    </div>
  </div>
</div>

<div class="popup" id="videoPopup">
  <div class="popup-content">
    <iframe id="videoFrame" width="100%" height="450" frameborder="0" allowfullscreen></iframe>
    <div style="display: flex; justify-content: flex-end; padding: 10px;">
    <button id="openInYoutubeBtn"
            style="background:#FF0000; color:#fff; padding:10px 20px; border:none;
                   border-radius:8px; cursor:pointer; font-family:Georgia,serif;
                   font-size:16px; margin-right: 20px;">
        ▶ YouTube'da Aç
    </button>
</div>
  </div>
</div>

<div class="popup" id="noteReadPopup">
  <div class="popup-content novel-style" style="display:flex; flex-direction:column; max-height:50vh;">
    <div id="noteReadContent" contenteditable="true" spellcheck="true" 
         style="flex:1; overflow-y:auto; padding-right:5px;">
      <!-- Note content will go here and is editable immediately -->
    </div>
    <div id="noteFooter" style="font-size:0.7em; color:#555; text-align:center; margin-top:5px;">
      Son Değiştirilme: --
    </div>
  </div>
</div>

<div class="popup" id="encouragePopup">
  <div class="popup-content" style="text-align:center;">
    <h2 style="font-size:50px; margin:4px;">👍</h2>
    <p id="encourageMessage" style="margin:7px 0 0 0; font-size:20px;">Devam et, sen çok iyisin!</p>
    <button onclick="hidePopup('encouragePopup')" 
            style="background:#28a745; color:#fff; padding:15px; border:none; margin-top:10px; font-family:Georgia, serif;">
      Tamam
    </button>
  </div>
</div>



<div class="confirm-popup" id="allDonePopup">
  <div class="confirm-content" style="font-family: Georgia, serif; font-size:1.2500em;">
    <div id="allDoneText">Uyarı!</div>
    <div class="confirm-buttons">
      <button class="yes" id="allDoneOk">Tamam</button>
    </div>
  </div>
</div>

<div class="confirm-popup" id="warnPopup">
  <div class="confirm-content" style="font-family: Georgia, serif; font-size:1.2500em;">
    <div id="warnText">Uyarı!</div>
    <div class="confirm-buttons">
      <button class="yes" id="warnYes">Evet</button>
      <button class="no" id="warnNo">Hayır</button>
    </div>
  </div>
</div>

<div class="popup" id="assessmentPopup">
  <div class="popup-content" style="display:flex; flex-direction:column; max-width:550px; width: 90%; height: 80vh; padding: 0; overflow: hidden;">
    <div id="assessmentDynamicContent" style="display: flex; flex-direction: column; height: 100%;"></div>
    <button id="assessmentClose" style="background:#28a745; color:#fff; padding:12px; border:none; font-family: Georgia, serif; margin:0 15px 15px 15px; border-radius:8px;">Kapat</button>
  </div>
</div>

<!-- Orkun'a Sor Popup -->
<div class="popup" id="askOrkunPopup">
  <div class="popup-content" style="max-width: 500px;">
    <h3 style="text-align: center; margin-bottom: 20px; color: #5458a6;">Orkun'a Gönder</h3>
    
 <!-- User Information Section -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
  <div>
    <label for="userName" style="display: block; margin-bottom: 5px; font-weight: bold;">Ad</label>
    <input type="text" id="userName" placeholder="Adın" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
  </div>
  <div>
    <label for="userSurname" style="display: block; margin-bottom: 5px; font-weight: bold;">Soyad</label>
    <input type="text" id="userSurname" placeholder="Soyadın" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
  </div>
</div>

<!-- ADD THIS NEW ROW FOR AGE, GENDER AND CITY -->
<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
  <div>
    <label for="userAge" style="display: block; margin-bottom: 5px; font-weight: bold;">Yaş</label>
    <input type="number" id="userAge" placeholder="Yaşın" min="1" max="120" style="width: 50%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
  </div>
  <div>
    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Cinsiyet</label>
    <div style="display: flex; gap: 15px;">
      <label style="display: flex; align-items: center;">
        <input type="radio" name="userGender" value="👩" style="margin-right: 5px;"> Kadın
      </label>
      <label style="display: flex; align-items: center;">
        <input type="radio" name="userGender" value="👨" style="margin-right: 5px;"> Erkek
      </label>
    </div>
  </div>
  <!-- ADD THIS NEW CITY FIELD -->
  <div>
    <label for="userCity" style="display: block; margin-bottom: 5px; font-weight: bold;">Şehir</label>
    <input type="text" id="userCity" placeholder="Şehrin" style="width: 60%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
  </div>
</div>
    
    <!-- Question Section -->
    <div style="margin-bottom: 15px;">
      <label for="askOrkunText" style="display: block; margin-bottom: 8px; font-weight: bold;">Orkun'a sorulacak soruları buraya yaz:</label>
      <textarea id="askOrkunText" placeholder="Sorularını buraya yaz..." style="width: 100%; height: 150px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; resize: vertical; font-family: Georgia, serif;"></textarea>
    </div>
    
    <!-- Share Notes Checkbox -->
    <div style="margin-bottom: 20px; display: flex; align-items: center;">
      <input type="checkbox" id="shareNotesCheckbox" style="margin-right: 10px;">
      <label for="shareNotesCheckbox" style="font-family: Georgia, serif;">Orkun'la Ders Notlarını Paylaş</label>
    </div>
    
    <!-- Action Buttons -->
    <div style="display: flex; justify-content: space-between;">
      <button id="askOrkunCancel" style="background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-family: Georgia, serif;">İptal</button>
      <button id="askOrkunSend" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-family: Georgia, serif;">Gönder</button>
    </div>
  </div>
</div>

<!-- NEW: Ben Kimim Popup -->
<div class="popup" id="benKimimPopup">
  <div class="popup-content">
    <h2 class="benkimim-title">Orkun Kumkale Kimdir?</h2>
    <br><center><img src="benkimim.jpg" alt="orkun" style="width: 130px;"></center></br>
    
    <!-- Scrollable content container -->
    <div class="benkimim-scrollable-content">
      <p class="benkimim-text">
        Orkun, insanların içsel potansiyellerini keşfetmelerine ve sosyal becerilerini 
        geliştirmelerine yardımcı olan etkileşimli programlar ve videolar üretmekte, katılımcıların günlük yaşamlarında pratik uygulamalar yaparak öz güvenlerini adım adım inşa etmelerini sağlamaktır.        
        2024 yılında açmış olduğu Youtube kanalında videolar paylaşmaktadır. Danışmanlık ve İletişim için: <strong>orkunkumkale@yahoo.com</strong>
        
        <!-- IMAGE GALLERY -->
<div class="vertical-gallery">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(1).jpg" alt="Ovgu 1">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(2).jpg" alt="Ovgu 2">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(3).jpg" alt="Ovgu 3">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(4).jpg" alt="Ovgu 4">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(5).jpg" alt="Ovgu 5">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(6).jpg" alt="Ovgu 6">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(7).jpg" alt="Ovgu 7">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(8).jpg" alt="Ovgu 8">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(9).jpg" alt="Ovgu 9">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(10).jpg" alt="Ovgu 10">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(11).jpg" alt="Ovgu 11">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(12).jpg" alt="Ovgu 12">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(13).jpg" alt="Ovgu 13">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(14).jpg" alt="Ovgu 14">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(15).jpg" alt="Ovgu 15">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(16).jpg" alt="Ovgu 16">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(17).jpg" alt="Ovgu 17">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(18).jpg" alt="Ovgu 18">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(19).jpg" alt="Ovgu 19">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(20).jpg" alt="Ovgu 20">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(21).jpg" alt="Ovgu 21">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(22).jpg" alt="Ovgu 22">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(23).jpg" alt="Ovgu 23">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(24).jpg" alt="Ovgu 24">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(25).jpg" alt="Ovgu 25">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(26).jpg" alt="Ovgu 26">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(27).jpg" alt="Ovgu 27">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(28).jpg" alt="Ovgu 28">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(29).jpg" alt="Ovgu 29">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(30).jpg" alt="Ovgu 30">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(31).jpg" alt="Ovgu 31">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(32).jpg" alt="Ovgu 32">
  <img src="https://github.com/orkunkumkale/gitkonus/blob/main/ovgu_(33).jpg" alt="Ovgu 33">
</div>
      </p>
    </div>
    
    <button class="benkimim-close-btn" onclick="hidePopup('benKimimPopup')">Kapat</button>
  </div>
</div>


<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }


/* --- SPLASH SCRIPT --- */
window.addEventListener("load", function () {
  setTimeout(() => {
    document.getElementById("splash").classList.add("hidden");
  }, 3000); // splash visible for 2 seconds
});

const lessonCompleteMessages = {
  0: "Bravo! Hayalini paylaşmak kolay değildir. Dalga geçileceğini sanarsın. Ama hiç de öyle olmadı değil mi? Hatta cesaretin bir adım öne çıktı. Artık hayallerin sadece zihninde değil, kendi realitende de var. Devam et, bu güven seninle büyüyecek.",
  1: "Tebrikler! Korkularını paylaşmak onları küçülttü. Daha büyük korkuların varsa, onları da zamanla paylaşacaksın. Tabii zamanı gelince. Kanayan yaraların sadece bir yara izi olduğu zaman artık korkmayacaksın. Çünkü biliyorsun ki HERKESİN acıları var. Ama şu saatten sonra, umarım artık korkuların eskisi kadar senin önünü kesemeyecek.",
  2: "Harika! Her yürüyüş, içindeki gücü biraz daha açığa çıkarıyor. Sanki hayatın sıkıcılığının içinde hızlı adımlarla geçip gittin ve bu sana bir cesaret aşıladı. Kimsenin dünyasına girmek zorunda değilsin. Kendi hayatının merkezinde, kalabalığın ve karanlığın içinden hiç etkilenmeden hızlıca geçerek, kendi yaşantında baş rol oynayacaksın. Emin adımlarla, sağa sola sapmadan, hedef belirleyerek, hayatı yara yara yürümeye devam et dostum!",
  3: "Mükemmel! Yeni alanlara adım attın. Öğrenmek, öz güvenin yakıtıdır ve öğreneceğin şeyler o kadar çok ki. Bu öğretiler de çok uzaklarda değil, yakınımızda. Şükret, ve yola devam et. Öğrenmeye, gelişmeye devam...",
  4: "Tebrikler! Kendi hayatının kahramanı olduğunu fark ettin umarım. Yazdığın her kelime, seni güçlendirdi ve geleceğe güvenle bakmanı sağladı. Artık VARSIN, çünkü bir hikayen var. Sorduklarında SEN KİMSİN diye, anlatacak bir şeylerin var. Dediğim gibi. Sen VARSIN ve bu çok güzel!",
  5: "Harika! İnsanlarla iletişime geçmek için adım attın. Sosyal cesaretini güçlendirdin ve artık biraz daha rahat iletişim kurabiliyorsun. Bunlardan çok daha fazlasını yapabileceğine eminim. Gördüğün her insanla konuşabilirsin. İnsanlardan korkmak, kötü insanlara cesaret verir. Onlardan korkma, yaklaşan sen ol, ki İYİLER seni çeksin, çünkü sen İYİSİN...",
  6: "Mükemmel! Yardım etmek, içsel gücünü artırır. İhtiyarların bize ihtiyacı var. VERMEK mühimdir, almaktan daha mühim. Unutma ki hayatının ilerleyen yıllarında vererek geçireceksin. Meyvelerini vermeye şimdiden başladığın için tebrik ederim",
  7: "Tebrikler! Disiplin ve irade gücünü gösterdin. Düzenli adımlar, içindeki öz güveni besler. Yapabileceğini gördün. Fark yaratabileceğini gördün. İstediğin zaman yaşantına kendi isteğinle YÖN verebileceğini gördün. Dizginleri eline al. Ne olursa olsun!",
  8: "Harika! Cesaretle soru sordun ve öğrenmeye açık olduğunu gösterdin. İnsanlarla etkileşim, öz güveni artıran en güçlü araçlardan biridir. Görüyorsun ki herkesin bir hikayesi var, herkes kendi yaşantısında baş rol oynamak istiyor. Ya sen? Ne zaman dizginleri eline alacaksın?",
  9: "Tebrikler! Biraz komik drama iyi gelmiştir umarım. Kendine olan kontrolünü ve korkusuzluğunu gösterdin. Artık utanç ve küçük endişeler seni durduramaz. Özgün ol, özgür ol!",
  10: "Mükemmel! Aile bağlarını güçlendirdin ve duygularını açıkça ifade ettin. Bu, hem öz güveni hem de kalbini iyileştirir.",
  11: "Tebrikler! Ailen çok mühimdir. Onlara karşı herhangi bir yara izi taşımamalısın. Özür dile, af dile veya affet. Hepsi bu kadar! Geçmişin yüklerini serbest bıraktın. Artık daha hafif ve özgür bir şekilde ilerleyebilirsin.",
  12: "Harika! Cesurca iletişim kurdun ve belki de hayallerin için adım attın. Büyük hedeflere ulaşmak, küçük adımlarla başlar. Büyük insanlarla iletişim kurmak seni bulunduğun konfor alanından çıkarır. Konuşmak zor değil, yeter ki kabuktan çık. Bunu başardığın için kutlarım.",
  13: "Tebrikler! Komşuluk unutulmaya yüz tutmuştu, alevlendirdin. Sosyal çevreni genişlettin ve ait olma hissini güçlendirdin. İnsanlarla bağ kurmak, öz güvenin temel taşlarından biridir.",
  14: "Mükemmel! Garsonlar etrafımızda var olan en görünmeyen hizmetkarlardır. Sen kimin hizmetkarısın? Evet, bunu düşünmelisin. Onlar nasıl seninle paylaşıyorsa sen de bir gün çıkardığın ürün veya hizmet ile insanlarla PAYLAŞACAKSIN. Paylaşmanın gücünü keşfettin. Ayrıca minnettar olursan, bir gün senden de minnettar olanlar çıkacaktır.",
  15: "Harika! On kişiye merhaba dediysen ne mutlu sana. Sosyal cesaretini oldukça geliştirdin demektir. Kimsenin birbirinden farkı yok. Herkes birinin ona gülümsemesini ve SEN DE VARSIN demesini bekliyor bu dünyada. Sen buna adım attın, insanların ruhlarına ışık tuttun. Küçük bir merhaba büyük bir fark yarattı ve seni daha görünür ve değerli kıldı.",
  16: "Tebrikler! Eğlence ve cesareti birleştirdin. Hayat o kadar da ciddiye almaya değmezmiş değil mi? Dayak yemedin, ölmedin. Zihnin korkulara rağmen yaşamaya devam ediyor. Kendinle dalga geçebilmek, öz güveni güçlendirir.",
  17: "Mükemmel! Kendinle UZUN SÜRE baş başa kaldın ve ekranların kölesi olmadın, kutlarım. Dijital sessizlik, zihinsel güç kazandırır. Darısı diğer insanların başına!",
  18: "Harika! Cesaretle farklı davrandın ve eğlenmeyi öğrendin. Kendini ifade etmekten korkmadığın sürece sınırların yok. Kimse seni dövmedi, kızmadı, aldırış etmedi. Öğrendin mi artık herkesin ne kadar kendi dünyasında yaşadığını. Korkacak birşey yok. Yürümeye devam!",
  19: "Tebrikler! Farklı olmayı kucakladın ve öz güven ve cesaretle dolaştın. Kendine güvenmek, başkalarının bakışlarına bağlı değildir. Kursun son görevin bu şekilde tamamladın. Tebrik ederim."
};

const videos = ["FCqoCWUCNuM","8u8-ZYVdY84","ELkoDRcZQmI","nIxB220RE8w","Li_62QYzl8E","iiHHAh3vMkU","iiJrB90w5CE","gpW-M-6NBRE","tNeR2p4930k","aIl0SttbfU0","deQ_SEiGU1w","8a0b_OO4I_w","A3F4Y_gTFx0","dy5KVYKeo9s","aC-j9y5oQhE","jVsXiR_BpkU","FYOe_rNKkLs","HSA1n4ebWp4","51tQrMvvb-0","82pd4RNa-rY"];
const titles = ["Hayallerimiz","Korkularımız","Hızlıca Yürü","Kursa Yazıl","Hikayeni Yaz","Bir Yabancı","Yaşlılarla","Sabahın Körü","Mağazaya Gir","Kahkaha At","Anne Baba","Küskün","Yayınevi","Komşu","Garson","Merhaba","Paraşüt","Telefonsuz","Noel Baba","Pabuçlar"];

const lessonMessages = [
  "Henüz tamamlanmış görevin yok!",
  "Yola çıktın, Tebrikler!",
  "Haydi devam. Yolun hala başı!",
  "Az Güç Az Tecrübe. 3 görev bitti!",
  "Hmm. Hiç fena değilsin. 4/20",
  "Emekleme dönemi bitti",
  "İyi gidiyorsun! Tamamlanan Görev: 6",
  "Doğrulma yolunda 7 görev aştın!",
  "Vay be! 8 görev hallettin",
  "Doğrulamaya pek az var! 9/20",
  "Bravo! Yolun yarısı...",
  "Iyi gidişat! 11 görev bitirdin",
  "Yarıyı geçtin. Eksikleri tamamla!",
  "Süper güce yaklaştın. 20'de 13!",
  "Harika! 14 görev bitirdin!",
  "Çok az kaldı! Tamamlanan Görev: 15",
  "16 görev zevkle bitti. Helal olsun!",
  "Ful potansiyel! 20'de 17!",
  "Tebrikler! 18 görev tamamladın!",
  "Seni kimse tutamadı, 20'de 19!"
];

const app = document.getElementById('app');
let savedData = JSON.parse(localStorage.getItem("lessonData")) || {};
let currentLessonDiv = null;
let confirmAction = null;

function saveData() { localStorage.setItem("lessonData", JSON.stringify(savedData)); }

function createLessonCard(index) {
  const lesson = document.createElement('div');
  lesson.className = 'lesson';
  lesson.dataset.index = index;
  app.appendChild(lesson);
  return lesson;
}

function buildLesson(index) {
  let lesson = document.querySelector(`.lesson[data-index='${index}']`) || createLessonCard(index);
  lesson.innerHTML = '';
  const prevCompleted = index === 0 || savedData[index - 1]?.completed || savedData[index - 1]?.skipped;
  const data = savedData[index];
  const isNewlyUnlocked = prevCompleted && !data?.completed && !data?.skipped;
  if (data?.completed) return buildCompletedLesson(lesson, index);
  if (data?.skipped && lesson.dataset.repeating !== "true") return buildSkippedLesson(lesson, index);
  if (!prevCompleted) return buildLockedLesson(lesson, index);
  buildUnfinishedLesson(lesson, index);
  // Only apply new-lesson animation if not the first lesson or if savedData has entries
  if (isNewlyUnlocked && (index !== 0 || Object.keys(savedData).length > 0)) {
    lesson.classList.add('new-lesson');
    setTimeout(() => lesson.classList.remove('new-lesson'), 1200); // Match animation duration
  }
}
function buildLessonTitle(imgSrc, text, onclick) {
  const titleDiv = document.createElement('div');
  titleDiv.className = 'lesson-title';
  const img = document.createElement('img');
  img.src = imgSrc;
  img.onclick = onclick;
  titleDiv.appendChild(img);
  titleDiv.appendChild(document.createTextNode(text));
  return titleDiv;
}

const circledNumbers = [
  "①","②","③","④","⑤","⑥","⑦ ","⑧","⑨","⑩",
  "⑪","⑫","⑬","⑭","⑮","⑯","⑰","⑱","⑲","⑳"
];

function buildLockedLesson(lesson, index) {
  lesson.style.background = '#e0e0e0';
  lesson.style.color = '#999';
  lesson.style.opacity = '0.5';
  const titleDiv = document.createElement('div');
  titleDiv.className = 'lesson-title';
  const img = document.createElement('img');
  img.src = `https://img.youtube.com/vi/${videos[index]}/hqdefault.jpg`;
  img.style.cursor = 'default';
  titleDiv.appendChild(img);
  titleDiv.appendChild(document.createTextNode(`${circledNumbers[index]} ${titles[index]}`));
  lesson.appendChild(titleDiv);
}

function buildUnfinishedLesson(lesson, index) {
  lesson.style.background = '#fdd607';
  lesson.style.color = '#000';
  lesson.style.opacity = '1';
  lesson.style.position = 'relative';

  const videoWrapper = document.createElement('div');
  videoWrapper.className = 'video-wrapper';

  const overlayThumb = document.createElement('img');
  overlayThumb.src = `https://img.youtube.com/vi/${videos[index]}/hqdefault.jpg`;
  overlayThumb.className = 'video-thumb';
  overlayThumb.onclick = () => openVideoPopup(videos[index]);

  const playBtn = document.createElement('div');
  playBtn.className = 'play-btn';
  playBtn.textContent = "";
  playBtn.onclick = () => openVideoPopup(videos[index]);



  // ADD YOUTUBE APP BUTTON
  const youtubeAppBtn = document.createElement('div');
  youtubeAppBtn.className = 'youtube-app-btn';
  youtubeAppBtn.innerHTML = '📱';
  youtubeAppBtn.title = "YouTube Uygulamasında Aç";
  youtubeAppBtn.onclick = (e) => {
    e.stopPropagation();
    openInYouTubeApp(videos[index]);
  };

  videoWrapper.appendChild(overlayThumb);
  videoWrapper.appendChild(playBtn);
  lesson.appendChild(videoWrapper);

  const titleContainer = document.createElement('div');
  titleContainer.className = 'lesson-title-container';

const lessonIcon = document.createElement('img');
  lessonIcon.src = 'yenigorev.png'; // Replace with your image path
  lessonIcon.style.width = '80px'; // Adjust size to match emoji (was 2em)
  lessonIcon.style.height = '69px';
  lessonIcon.style.marginRight = '8px';
  lessonIcon.style.verticalAlign = 'middle'; // Align with text
  lessonIcon.className = 'tremble'; // Add tremble animation
  titleContainer.appendChild(lessonIcon);

  const lessonTitle = document.createElement('span');
  lessonTitle.innerHTML = `<span style="font-size: 0.6em; color: #000000; opacity: 0.6; margin-right: 8px;">${circledNumbers[index]}</span><span style="font-size: 1em; opacity: 0.9; margin-right: 8px;">${titles[index]}</span>`;
  lessonTitle.style.cursor = "pointer";
  lessonTitle.style.fontSize = "1.9em";
  lessonTitle.style.fontWeight = "bold";
  lessonTitle.onclick = () => openVideoPopup(videos[index]);
  titleContainer.appendChild(lessonTitle);

  lesson.appendChild(titleContainer);

  const doneBtn = document.createElement('button');
  doneBtn.className = 'done-btn';
  doneBtn.textContent = "Görevi Tamamla";
  doneBtn.style.fontFamily = "Georgia, serif";
  doneBtn.onclick = () => { currentLessonDiv = lesson; showPopup('popup'); };
  lesson.appendChild(doneBtn);
}

function buildCompletedLesson(lesson, index) {
  lesson.style.background = '#6ca178'; // Example: green for completed
  lesson.style.color = '#000000'; // White text for contrast
  lesson.style.opacity = '0.5'; // Slightly less faded
  lesson.style.position = 'relative';

  const titleDiv = buildLessonTitle(
    `https://img.youtube.com/vi/${videos[index]}/hqdefault.jpg`,
    `${circledNumbers[index]} ${titles[index]}`,
    () => openVideoPopup(videos[index])
  );

  titleDiv.firstChild.style.position = 'relative';

  const tamamlandi = document.createElement('button');
  tamamlandi.textContent = "BİTTİ ✅";
  tamamlandi.style.position = 'absolute';
  tamamlandi.style.top = '6px';
  tamamlandi.style.right = '6px';
  tamamlandi.style.background = '#4caf50';
  tamamlandi.style.color = '#fff';
  tamamlandi.style.padding = '2px 6px';
  tamamlandi.style.borderRadius = '4px';
  tamamlandi.style.fontSize = '0.7em';
  tamamlandi.style.fontWeight = 'bold';
  tamamlandi.style.fontFamily = 'Georgia, serif';
  tamamlandi.style.boxShadow = '0 1px 3px rgba(0,0,0,0.3)';
  tamamlandi.style.cursor = 'pointer';
  tamamlandi.onclick = () => openNoteReadPopup(lesson);
  titleDiv.firstChild.parentElement.appendChild(tamamlandi);

  lesson.appendChild(titleDiv);

  lesson.style.cursor = 'pointer';
  lesson.onclick = (e) => {
    if (e.target.tagName.toLowerCase() === 'img') return;
    openNoteReadPopup(lesson);
  };
}

function buildSkippedLesson(lesson, index) {
  lesson.style.background = '#6c6fab';
  lesson.style.color = '#000';
  lesson.style.opacity = '0.6';

  const titleDiv = buildLessonTitle(
    `https://img.youtube.com/vi/${videos[index]}/hqdefault.jpg`,
    `${circledNumbers[index]} ${titles[index]}`,
    () => openVideoPopup(videos[index])
  );

  titleDiv.firstChild.style.position = 'relative';
  
  const assessmentViewed = savedData.assessmentViewed || false;

  if (!assessmentViewed) {
    const repeat = document.createElement('span');
    repeat.textContent = "ATLANDI 🔄";
    repeat.style.position = 'absolute';
    repeat.style.top = '6px';
    repeat.style.right = '6px';
    repeat.style.background = '#5458a6';
    repeat.style.color = '#fff';
    repeat.style.padding = '2px 6px';
    repeat.style.borderRadius = '4px';
    repeat.style.fontSize = '0.7em';
    repeat.style.cursor = 'pointer';
    repeat.style.fontWeight = 'bold';
    repeat.style.boxShadow = '0 1px 3px rgba(0,0,0,0.3)';
    repeat.onclick = () => {
      currentLessonDiv = lesson;
      confirmAction = () => {
        hidePopup('confirmPopup');
        openNotePopup(lesson);
      };
      document.getElementById('confirmText').textContent = "Dersi Tamamladın mı? Öyleyse yeni notunu yaz, nasıl başardığını anlat";
      document.getElementById('confirmYes').textContent = "Tamam";
      document.getElementById('confirmNo').textContent = "İptal";
      showPopup('confirmPopup');
    };
    titleDiv.firstChild.parentElement.appendChild(repeat);

    lesson.style.cursor = 'pointer';
    lesson.onclick = (e) => {
      if (e.target.tagName.toLowerCase() === 'img') return;
      currentLessonDiv = lesson;
      confirmAction = () => {
        hidePopup('confirmPopup');
        openNotePopup(lesson);
      };
      document.getElementById('confirmText').textContent = "Dersi Tamamladın mı? Öyleyse yeni notunu yaz, nasıl başardığını anlat";
      document.getElementById('confirmYes').textContent = "Tamam";
      document.getElementById('confirmNo').textContent = "İptal";
      showPopup('confirmPopup');
    };
  } else {
    lesson.style.cursor = 'default';
    lesson.onclick = null; // Explicitly remove onclick to prevent any row interaction
  }

  lesson.appendChild(titleDiv);
}

window.addEventListener("load", () => {
  const unfinished = document.querySelector(".lesson:not(.completed)");
  if (unfinished) {
    unfinished.scrollIntoView({ behavior: "smooth", block: "center" });
  }
});

function openVideoPopup(videoId) {
  document.getElementById("videoFrame").src =
    `https://www.youtube.com/embed/${videoId}?autoplay=1`;
  showPopup('videoPopup');

  const btn = document.getElementById("openInYoutubeBtn");
  btn.onclick = () => {
    openInYouTubeApp(videoId);
  };
}

function openInYouTubeApp(videoId) {
  // For Android
  const androidIntent = `https://www.youtube.com/watch?v=${videoId}`;
  
  // For iOS
  const iosUrl = `vnd.youtube://watch?v=${videoId}`;
  
  // Try Android intent first
  window.location.href = androidIntent;
  
  // Fallback for iOS and if Android intent fails
  setTimeout(() => {
    if (!document.webkitHidden && !document.hidden) {
      window.location.href = iosUrl;
      
      // Final fallback to web
      setTimeout(() => {
        if (!document.webkitHidden && !document.hidden) {
          window.open(`https://www.youtube.com/watch?v=${videoId}`, "_blank");
        }
      }, 500);
    }
  }, 200);
}

function scrollToNextUnfinished(currentIndex) {
  for (let i = currentIndex + 1; i < videos.length; i++) {
    if (!savedData[i]?.completed && !savedData[i]?.skipped) {
      const nextLesson = document.querySelector(`.lesson[data-index='${i}']`);
      if (nextLesson) {
        nextLesson.scrollIntoView({ behavior: "smooth", block: "center" });
      }
      break;
    }
  }
}

function showPopup(id) {
  const p = document.getElementById(id);
  
  if (id === 'assessmentPopup') {
    // Special handling for assessment popup with slow animation
    p.style.display = 'flex';
    p.style.background = 'transparent'; // Ensure no background
    
    // Small delay to allow display to take effect before starting animation
    setTimeout(() => {
      p.classList.add('show');
    }, 10);
    
    // Scroll assessment popup content to top when shown
    setTimeout(() => {
      const assessmentContent = document.getElementById('assessmentDynamicContent');
      if (assessmentContent) {
        assessmentContent.scrollTop = 0;
      }
    }, 50);
  } else {
    // Regular popup behavior
    p.classList.add('show');
    p.style.display = 'flex';
  }
}

function hidePopup(id) {
  const p = document.getElementById(id);
  if (p) {
    p.classList.remove('show');
    
    if (id === 'assessmentPopup') {
      // Wait for animation to complete before hiding
      setTimeout(() => {
        p.style.display = 'none';
      }, 800); // Match the transition duration (0.8s = 800ms)
    } else {
      // Regular popup behavior
      setTimeout(() => {
        p.style.display = 'none';
        if (id === 'videoPopup') document.getElementById("videoFrame").src = "";
      }, 300);
    }
  }
}

document.getElementById('completeLesson').onclick = () => {
  hidePopup('popup');
  
  // Make sure we have the correct current lesson div
  if (currentLessonDiv) {
    const index = parseInt(currentLessonDiv.dataset.index);
    currentLessonDiv = document.querySelector(`.lesson[data-index="${index}"]`);
    
    // Reset the note popup to normal state before opening
    resetNotePopup();
    openNotePopup(currentLessonDiv);
  }
};

// Replace the current skipLessonBtn onclick handler
document.getElementById('skipLessonBtn').onclick = () => {
  hidePopup('popup');
  
  // Store the current lesson div reference
  const lessonToSkip = currentLessonDiv;

  // Show confirmation popup first
  confirmAction = () => {
    hidePopup('confirmPopup');
    openSkipNotePopup(lessonToSkip); // Use the local variable, not currentLessonDiv
  };

 document.getElementById('confirmText').textContent = "Bu görevi sonra da tamamlayabilirsin ama atlama sebebini yazman gerekiyor. Hazır mısın?";
  document.getElementById('confirmYes').textContent = "Evet";
  document.getElementById('confirmNo').textContent = "İptal";
  showPopup('confirmPopup');
};

// Create a function to open the skip note popup
function openSkipNotePopup(lessonDiv) {
  currentLessonDiv = lessonDiv;
  const index = parseInt(lessonDiv.dataset.index);
  document.getElementById('notePopupHeader').textContent = `${index + 1}. Görev Atlanıyor`;
  document.getElementById('noteInput').value = savedData[index]?.skipNote || '';
  
  // Reset font styles to default or smaller
  noteMessage.style.fontSize = '12px';
  noteMessage.style.fontWeight = 'normal';
  document.getElementById('wordProgress').style.width = '0%';
  document.querySelector('.word-progress').style.display = 'none';
  
  // Set up for skip note (no word count requirement)
  const saveBtn = document.getElementById('saveNote');
  saveBtn.textContent = "Notu Kaydet ve Görevi ATLA";
  
  // Remove any existing click handlers by replacing the element
  const newSaveBtn = saveBtn.cloneNode(true);
  saveBtn.parentNode.replaceChild(newSaveBtn, saveBtn);
  
  // Add the skip note handler
  newSaveBtn.addEventListener('click', saveSkipNote);
  
  showPopup('notePopup');
}

// Function to save skip notes (no word count requirement)
function saveSkipNote() {
  const text = noteInput.value.trim();
  const index = parseInt(currentLessonDiv.dataset.index);
  const now = new Date().toLocaleString();
  
  // Save the skip note
  savedData[index] = { 
    ...savedData[index], 
    skipped: true,
    skipNote: text, 
    skipDate: now 
  };
  
  saveData();
  hidePopup('notePopup');
  noteInput.value = '';
  
  // Reset the note popup to its original state
  resetNotePopup();

  
  // Rebuild the lesson and move to next
  buildLesson(index);
  if (index + 1 < videos.length) buildLesson(index + 1);
  scrollToNextUnfinished(index);
  checkAllHandled();
}

// Function to reset the note popup to its original state
function resetNotePopup() {
  const noteMessage = document.getElementById('noteMessage');
  noteMessage.textContent = `${10} kelime daha yaz.`;
  noteMessage.style.color = 'green';
  noteMessage.style.display = 'none';
  
  document.querySelector('.word-progress').style.display = 'block';
  document.getElementById('wordProgress').style.width = '0%';
  
  const saveBtn = document.getElementById('saveNote');
  saveBtn.textContent = "Notu Kaydet";

  // Remove any existing click handlers by replacing the element
  const newSaveBtn = saveBtn.cloneNode(true);
  saveBtn.parentNode.replaceChild(newSaveBtn, saveBtn);
  
  // Add the correct click handler for normal note saving
  newSaveBtn.addEventListener('click', function saveNormalNote() {
    const text = noteInput.value.trim();
    const words = text.split(/\s+/).filter(w => w).length;
    if (words < 10) {
      noteMessage.style.display = 'block';
      noteMessage.style.color = 'green';
      noteMessage.style.fontSize = '1.2em';
      noteMessage.style.fontWeight = 'bold';
      noteMessage.textContent = `${10 - words} kelime daha yaz.`;
      return;
    }
    confirmAction = () => {
      const index = parseInt(currentLessonDiv.dataset.index);
      const now = new Date().toLocaleString();
      savedData[index] = { ...savedData[index], note: text, lastEdited: now };
      saveData();
      hidePopup('notePopup');
      noteInput.value = '';
      wordProgress.style.width = '0%';
      const msg = lessonCompleteMessages[index] || "Harika! Bir dersi daha tamamladınız.";
      document.getElementById('encourageMessage').textContent = msg;
      showPopup('encouragePopup');
      document.querySelector('#encouragePopup button').onclick = () => {
        hidePopup('encouragePopup');
        savedData[index].completed = true;
        saveData();
        buildLesson(index);
        updateProgress();
        updateTopMessage(index);
        if (index + 1 < videos.length) buildLesson(index + 1);
        scrollToNextUnfinished(index);
        checkAllHandled();
      };
    };
    document.getElementById('confirmText').textContent = "Notunu kaydedip bir dahaki göreve geçmek istiyor musun?";
    showPopup('confirmPopup');
  });
  
  // Update the reference to the new button
  document.getElementById('saveNote').id = 'saveNote'; // Ensure ID is preserved
}

document.getElementById('popup').addEventListener("click", e => {
  if (e.target.id === "popup") hidePopup('popup');
});

const notePopup = document.getElementById('notePopup');
const noteInput = document.getElementById('noteInput');
const wordCount = document.getElementById('wordCount');
const noteMessage = document.getElementById('noteMessage');
const wordProgress = document.getElementById('wordProgress');

function openNotePopup(lessonDiv) {
  currentLessonDiv = lessonDiv;
  notePopup.style.display = 'flex';
  notePopup.classList.add('show');
  noteInput.value = savedData[lessonDiv.dataset.index]?.note || '';
  const lessonIndex = parseInt(lessonDiv.dataset.index);
  document.getElementById('notePopupHeader').textContent = `${lessonIndex + 1}. Görev: ${titles[lessonIndex]}`;
  updateWordCount();

  noteMessage.style.display = 'none';
}

function updateWordCount() {
  const words = noteInput.value.trim().split(/\s+/).filter(w => w).length;
  noteMessage.style.display = words < 10 ? 'block' : 'none';
  noteMessage.textContent = words < 10 ? `${10 - words} kelime daha yaz.` : '';
  const percent = Math.min((words / 10) * 100, 100);
  document.getElementById('wordProgress').style.width = percent + '%';
}

noteInput.addEventListener('input', updateWordCount);

document.getElementById('cancelNote').onclick = () => {
  hidePopup('notePopup');
  noteInput.value = '';
  noteMessage.style.display = 'none';
  wordProgress.style.width = '0%';

  // Reset the popup to normal note state
  resetNotePopup();
  
  // ADD THESE LINES TO RESET THE STATE:
  confirmAction = null; // Reset the confirmAction
  currentLessonDiv = null; // Reset the current lesson reference
  
  // Also reset the save button back to normal note saving
  const saveBtn = document.getElementById('saveNote');
  saveBtn.textContent = "Notu Kaydet";
  saveBtn.onclick = function() {
    const text = noteInput.value.trim();
    const words = text.split(/\s+/).filter(w => w).length;
    if (words < 10) {
      noteMessage.style.display = 'block';
      noteMessage.style.color = 'green';
      noteMessage.style.fontSize = '1.2em';
      noteMessage.style.fontWeight = 'bold';
      noteMessage.textContent = `${10 - words} kelime daha yaz.`;
      return;
    }
    confirmAction = () => {
      const index = parseInt(currentLessonDiv.dataset.index);
      const now = new Date().toLocaleString();
      savedData[index] = { ...savedData[index], note: text, lastEdited: now };
      saveData();
      hidePopup('notePopup');
      noteInput.value = '';
      wordProgress.style.width = '0%';
      const msg = lessonCompleteMessages[index] || "Harika! Bir dersi daha tamamladınız.";
      document.getElementById('encourageMessage').textContent = msg;
      showPopup('encouragePopup');
      document.querySelector('#encouragePopup button').onclick = () => {
        hidePopup('encouragePopup');
        savedData[index].completed = true;
        saveData();
        buildLesson(index);
        updateProgress();
        updateTopMessage(index);
        if (index + 1 < videos.length) buildLesson(index + 1);
        scrollToNextUnfinished(index);
        checkAllHandled();
      };
    };
    document.getElementById('confirmText').textContent = "Notunu kaydedip bir dahaki göreve geçmek istiyor musun?";
    showPopup('confirmPopup');
  };
};

document.getElementById('confirmYes').onclick = () => {
  if (confirmAction) confirmAction();
  hidePopup('confirmPopup');
  confirmAction = null;
};

document.getElementById('confirmNo').onclick = () => {
  hidePopup('confirmPopup');
  confirmAction = null; // reset so old action doesn't carry over
};

document.getElementById("videoPopup").addEventListener("click", e => {
  if (e.target.id === "videoPopup") hidePopup('videoPopup');
});

const menuBtn = document.getElementById('menuBtn');
const menuDropdown = document.getElementById('menuDropdown');
menuBtn.addEventListener('click', (e) => {
  menuDropdown.style.display = menuDropdown.style.display === 'flex' ? 'none' : 'flex';
  menuDropdown.style.flexDirection = 'column';
});
document.addEventListener('click', (e) => {
  if (!menuBtn.contains(e.target)) menuDropdown.style.display = 'none';
});

document.getElementById('resetLessons').onclick = () => {
  resetLessons();
};

// Replace the current copyNotesBtn onclick handler
document.getElementById('copyNotesBtn').onclick = () => {
  copyAllNotes(); // New function that copies both completed and skipped notes
};

// Function to copy both completed and skipped notes
function copyAllNotes() {
  let allNotesText = "=== GÖREV NOTLARI ===\n\n";
  
  // Collect all lessons (completed or skipped) in consecutive order
  const allLessons = [];
  for (let i = 0; i < videos.length; i++) {
    const data = savedData[i] || {};
    const lessonNumber = i + 1;
    const lessonName = titles[i];
    let lessonText = '';

   // Add separator before each lesson (except the first one)
    if (i > 0) {
      lessonText += "-----------------------------------\n\n";
    }
    
    // Add skipped note if it exists
    if (data.skipped && data.skipNote) {
      const skipNoteText = data.skipNote;
      const skipDate = data.skipDate ? data.skipDate : "--";
      lessonText += `ATLANDI 🔄 - ${lessonNumber}. ${lessonName}\nAtlanma Sebebi: ${skipNoteText}\nAtlanma Tarihi: ${skipDate}`;
    } else if (data.skipped) {
      const skipDate = data.skipDate ? data.skipDate : "--";
      lessonText += `ATLANDI 🔄 - ${lessonNumber}. ${lessonName}\nAtlanma Sebebi: Belirtilmemiş\nAtlanma Tarihi: ${skipDate}`;
    }
    
    // Add completed note if it exists, with a separator if there was a skip note
    if (data.completed && data.note) {
      if (lessonText) lessonText += '\n\n';
      const noteText = data.note;
      const editedDate = data.lastEdited ? data.lastEdited : "--";
      lessonText += `BİTTİ ✅  - ${lessonNumber}. ${lessonName}\n${noteText}\nSon Değiştirilme: ${editedDate}`;
    }
    
    if (lessonText) {
      allLessons.push(lessonText);
    }
  }
  
  // Combine lessons with double newlines
  allNotesText += allLessons.join("\n\n");
  
  // If no notes or skipped lessons, show message
  if (!allLessons.length) {
    showToast("Kopyalanacak not yok!");
    return;
  }


  
  // Add summary information

let lastCompletedLesson = 0;
for (let i = 0; i < videos.length; i++) {
  if (savedData[i]?.completed) {
    lastCompletedLesson = i + 1; // lesson numbers are 1-based
  }
}
  const totalLessons = videos.length;
  const completedCount = Object.values(savedData).filter(d => d.completed).length;
const remainingCount = totalLessons - lastCompletedLesson;
  const skippedCount = totalLessons - remainingCount - completedCount;

  
  allNotesText += `\n\n=== ÖZET ===
Toplam Görev: ${totalLessons}
Tamamlanan: ${completedCount}

\n`;
  
  // Add current date
  const currentDate = new Date().toLocaleString('tr-TR');
  allNotesText += `Kopyalama Tarihi: ${currentDate}`;
  
  // Copy to clipboard
  const temp = document.createElement('textarea');
  temp.value = allNotesText;
  document.body.appendChild(temp);
  temp.select();
  try { 
    document.execCommand('copy'); 
    showToast("Tüm notlar ve atlama sebepleri kopyalandı!");
  } catch (e) { 
    console.error(e);
    showToast("Kopyalama hatası!");
  }
  document.body.removeChild(temp);
}

function showToast(msg) {
  const toast = document.createElement('div');
  toast.textContent = msg;
  Object.assign(toast.style, {
    position: 'fixed',
    top: '50%',
    left: '50%',
    transform: 'translate(-50%, -50%)',
    background: '#28a745',
    color: '#fff',
    padding: '12px 25px',
    borderRadius: '8px',
    boxShadow: '0 2px 10px rgba(0,0,0,0.3)',
    fontWeight: 'bold',
    fontSize: '1em',
    maxWidth: '80%',
    textAlign: 'center',
    zIndex: 9999,
    pointerEvents: 'none',
    lineHeight: '1.2',
  });
  document.body.appendChild(toast);
  toast.style.opacity = '0';
  toast.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
  requestAnimationFrame(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translate(-50%, -50%) scale(1.05)';
  });
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translate(-50%, -50%) scale(1)';
    setTimeout(() => document.body.removeChild(toast), 300);
  }, 2000);
}

function triggerBounce(id) {
  const step = document.getElementById(id);
  if (!step.classList.contains('bounced')) {
    step.classList.add('bounce', 'bounced');
    setTimeout(() => step.classList.remove('bounce'), 700);
  }
}

function updateProgress() {
  const totalLessons = videos.length;
  const completedLessons = Object.values(savedData).filter(d => d.completed).length;
  const progress = completedLessons / totalLessons;
  if (completedLessons >= 0) triggerBounce('stepBeginner');
  if (progress >= 0.25) triggerBounce('stepBronze');
  if (progress >= 0.5) triggerBounce('stepSilver');
  if (progress >= 0.85) triggerBounce('stepGold');
  document.getElementById('stepBeginner').classList.toggle('completed', completedLessons >= 0);
  document.getElementById('stepBronze').classList.toggle('completed', progress >= 0.25);
  document.getElementById('stepSilver').classList.toggle('completed', progress >= 0.5);
  document.getElementById('stepGold').classList.toggle('completed', progress >= 0.85);
  const progressLine = document.getElementById('progressLine');
  progressLine.style.width = (progress * 100) + "%";
}

function openNoteReadPopup(lessonDiv) {
  currentLessonDiv = lessonDiv;
  const index = parseInt(lessonDiv.dataset.index);
  const noteData = savedData[index] || {};
  const popupContent = document.querySelector("#noteReadPopup .popup-content");
  const oldClose = document.getElementById("noteReadCloseBtn");
  if (oldClose) oldClose.remove();
  const closeBtn = document.createElement('span');
  closeBtn.id = "noteReadCloseBtn";
  closeBtn.textContent = "×";
  closeBtn.style.position = "absolute";
  closeBtn.style.top = "6px";
  closeBtn.style.right = "8px";
  closeBtn.style.fontSize = "0.9em";
  closeBtn.style.cursor = "pointer";
  closeBtn.style.color = "#333";
  closeBtn.style.opacity = "0.6";
  closeBtn.title = "Kapat";
  closeBtn.onclick = () => {
    const noteDiv = document.getElementById("noteReadContent");
    const text = noteDiv.textContent.trim();
    if (text) {
      const index = parseInt(currentLessonDiv.dataset.index);
      const now = new Date().toLocaleString();
      savedData[index] = { ...savedData[index], note: text, lastEdited: now };
      saveData();
      buildLesson(index);
    }
    hidePopup('noteReadPopup');
  };
  popupContent.style.position = "relative";
  popupContent.appendChild(closeBtn);
  let noteHeader = document.getElementById('noteReadHeader');
  if (!noteHeader) {
    noteHeader = document.createElement('div');
    noteHeader.id = 'noteReadHeader';
    noteHeader.style.fontSize = '1.3em';
    noteHeader.style.fontWeight = 'bold';
    noteHeader.style.color = '#555';
    noteHeader.style.marginBottom = '6px';
    noteHeader.style.textAlign = "center";
    popupContent.insertBefore(noteHeader, document.getElementById('noteReadContent'));
  }
  noteHeader.innerHTML = `${index + 1}. ${titles[index]} (Notlar)`;
  document.getElementById("noteReadContent").textContent = noteData.note || "(Henüz not yok)";
  const footer = document.getElementById("noteFooter");
  const lastEdited = noteData.lastEdited ? noteData.lastEdited : "--";
  footer.textContent = `Son Değiştirilme: ${lastEdited} `;
  showPopup('noteReadPopup');
}

document.getElementById("noteReadPopup").addEventListener("click", e => {
  if (e.target.id === "noteReadPopup") {
    const noteDiv = document.getElementById("noteReadContent");
    const text = noteDiv.textContent.trim();
    if (text) {
      const index = parseInt(currentLessonDiv.dataset.index);
      const now = new Date().toLocaleString();
      savedData[index] = { ...savedData[index], note: text, lastEdited: now };
      saveData();
      buildLesson(index);
    }
    hidePopup('noteReadPopup');
  }
});

function checkAllHandled() {
  const allHandled = Array.from({length: videos.length}, (_, i) => savedData[i] && (savedData[i].completed || savedData[i].skipped)).every(Boolean);
  if (allHandled) {
    showEvaluationButton(); // Show the "Değerlendirme" button immediately
    if (!savedData.allHandledShown) {
      savedData.allHandledShown = true;
      saveData();
      showAllDonePopup(); // Show the popup after the button
    }
  }
}

function showAllDonePopup() {
  const message = "Yeni görev kalmadı.<br><i> Atlamıştım ama tekrar deneyeceğim </i>  dediğin görev varsa ve o görevi başarırsan <span style='background-color: #5458a6; color: white; padding: 2px 2px; border-radius: 2px; font-weight: bold; font-size:16px;'> ATLANDI 🔄 </span> <br> tuşuna basıp nasıl başardığına dair notlarını gir. Böylece o görevi <span style='background-color: #268235; color: white; padding: 2px 2px; border-radius: 2px; font-weight: bold; font-size:16px;'> BİTTİ  </span> <br> konumuna getirebilirsin. Kursu bitirmek için ise, <span style='background-color: #d49c02; color: BLACK; padding: 2px 2px; border-radius: 2px; font-size:16px;' font-weight: bold;> 🏆 SONUÇ 🏆</span> butonuna bas, değerlendirme notunu öğren.";
  
  document.getElementById('allDoneText').innerHTML = message;
  showPopup('allDonePopup');
}

function showEvaluationButton() {
  // Check if the button already exists first
  if (document.getElementById('evalBtn')) {
    return; // Exit if the button is already there
  }

  const btn = document.createElement('button');
  btn.id = 'evalBtn';
  btn.textContent = ' 🏆 SONUÇ 🏆';
  btn.style.background = '#d49c02';
  btn.style.color = '#fff';
  btn.style.padding = '10px 20px';
  btn.style.border = 'none';
  btn.style.borderRadius = '8px';
  btn.style.cursor = 'pointer';
  btn.style.marginTop = '20px';
  btn.style.alignSelf = 'center';
  btn.style.fontSize = '1.9em';
  btn.style.fontFamily = 'Georgia, serif';
  btn.style.display = 'block';
  btn.style.margin = '20px auto';
  btn.onclick = () => {
  if (savedData.assessmentViewed) {
    populateAssessmentPopup();
    showPopup('assessmentPopup');
  } else {
    document.getElementById('warnText').textContent = "Bu aşamadan sonra ATLANAN görevleri yapabilme şansın kalmayacak. Son değerlendirmeye hazır mısın?";
    showPopup('warnPopup');
  }
};
  app.appendChild(btn);
  // Add celebration effect if this is the first time showing
  if (!savedData.confettiShown) {
    // Small delay to ensure button is rendered
    setTimeout(() => {
      createConfetti(btn);
      
      // Add pulsing animation to the button
      btn.style.animation = 'pulseCelebration 2s ease-in-out';
      
      
      
      savedData.confettiShown = true;
      saveData();
    }, 300);
  }

  // Persist the button state
  savedData.evalButtonShown = true;
  saveData();
}


document.getElementById('allDoneOk').onclick = () => { hidePopup('allDonePopup'); showEvaluationButton(); };

document.getElementById('warnYes').onclick = () => {
  hidePopup('warnPopup');
  populateAssessmentPopup();
  showPopup('assessmentPopup');
  savedData.assessmentViewed = true;
  saveData();
  for (let i = 0; i < videos.length; i++) {
    if (savedData[i]?.skipped) {
      buildLesson(i);
    }
  }
};

document.getElementById('warnNo').onclick = () => {
  hidePopup('warnPopup');
  confirmAction = null; // reset
};

document.getElementById('assessmentClose').onclick = () => { hidePopup('assessmentPopup'); };

document.getElementById('assessmentPopup').addEventListener("click", e => {
  if (e.target.id === "assessmentPopup") hidePopup('assessmentPopup');
});

function scrollToFirstUnfinishedLesson() {
  for (let i = 0; i < videos.length; i++) {
    if (!savedData[i]?.completed && !savedData[i]?.skipped) {
      const lessonDiv = document.querySelector(`.lesson[data-index='${i}']`);
      if (lessonDiv) {
        lessonDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
      break;
    }
  }
}

function updateTopMessage(index) {
  const topLeft = document.getElementById("tinyTopLeft");
  const bottomText = document.querySelector(".bottom-text");
  const remainingTasks = videos.length - Object.values(savedData).filter(d => d.completed || d.skipped).length;
  const completedLessons = Object.values(savedData).filter(d => d.completed).length;
  bottomText.textContent = remainingTasks > 0
    ? lessonMessages[Math.min(completedLessons, lessonMessages.length - 1)]
    : "Görev kalmadı. SONUÇ en altta 👇";
  topLeft.textContent = bottomText.textContent;
}


function populateAssessmentPopup() {
  const completed = Object.values(savedData).filter(d => d.completed).length;
  let imgSrc, region, openingMessage, secondMessage;

  if (completed <= 4) {
    imgSrc = '0001_tokez.png';
    region = 'Emekleyen Kişi';
    secondMessage = "Henüz yolun başında iken görevleri bırakman, geleceğinle ilgili kazanmak için çıktığın öz güven yolculuğunu ertelemen veya tamamen vazgeçmen anlamına geliyor. Benim tavsiyem eksiklik duyduğun konuların üzerine eğilmek için çaba göstermek, belki şimdi değil ama üzerinde biraz süre kafa patlatıp, tamamlayamadığın eksik görevleri tamamlamak, hatta bu görevlere yeniden başlamak, sıfırdan bir sayfa açmak. <br><br> Peki bundan sonra ne mi yapabilirsin? Eğer şu anda geldiğin seviyede başka bir görevi daha yapmak istemiyorum, artık buna vakit ayıramam, veya yapamıyorum, zorlanıyorum diyorsan o zaman bana bu kurs sırasında aldığın notları gönder ki bir değerlendirme yapayım. Bu kurs senin için bir KENDİNİ AÇIKLAMA VE HATALARI TESPİT kursu olsun. Eksiklerinin hangi alanda olduğunu, hangi alanda sosyal ihtiyaçlara sahip olduğunu, hangi alanlarda güçlü olduğunu tespit etmiş olduk. Bunları bana aktarırsan üzerinde yorumum olur ve sana özel bir değerlendirme yapmış olurum. Böylece öz güven konusunda daha bilinçli hareket etmiş olursun. Yapamadığın görevler için kendini cezalandırma. Dediğim gibi, bana yaz ve benden yorum bekle. Aşağıdaki linke tıkla ve bana bu kurstaki başarın/başarısızlığın konusunda email yaz lütfen. Ayrıca eğer benimle telefonda görüşmek istersen ve danışmanlık almak istersen de yine mail yolu ile bana ulaşman gerekiyor. Bu kursta benimle olduğun için teşekkür ederim. Aplikasyonda hatalar tespit ettiysen de yine yazmaktan çekinme.";
  } else if (completed <= 9) {
    imgSrc = '0002_kalkmak.png';
    region = 'Kalkmaya Başlayan Kişi';
    secondMessage = "Yine de tebrik ederim. Kalkmaya çalıştın, mukavemet gösterdin.  Aslında biraz daha cesaretini toplasaydın ve Dayanan Kişi bölgesine ulaşsaydın, çok iyi olurdu. Belki ileride bunu gerçekleştirmek isteyebilirsin. Üzerinde biraz daha kafa patlatıp, tamamlayamadığın görevleri tamamlamak, hatta bu görevlere yeniden başlamak, sıfırdan bir sayfa açmak iyi olurdu. <br><br> Peki bundan sonra ne mi yapabilirsin? Eğer şu anda geldiğin seviyede başka bir görevi daha yapmak istemiyorum, artık buna vakit ayıramam, veya yapamıyorum, zorlanıyorum diyorsan o zaman bana bu kurs sırasında aldığın notları gönder ki bir değerlendirme yapayım. Aşağıdaki linke tıkla ve bana bu kurstaki başarın/başarısızlığın konusunda email yaz lütfen. Bu kurs senin için bir KENDİNİ AÇIKLAMA VE HATALARI TESPİT kursu olsun. Eksiklerinin hangi alanda olduğunu, hangi alanda sosyal ihtiyaçlara sahip olduğunu, hangi alanlarda güçlü olduğunu tespit etmiş olduk. Bunları bana aktarırsan üzerinde yorumum olur ve sana özel bir değerlendirme yapmış olurum. Böylece öz güven konusunda daha bilinçli hareket etmiş olursun. Yapamadığın görevler için kendini cezalandırma. Dediğim gibi, bana yaz ve benden yorum bekle. Aşağıdaki linke tıkla ve bana bu kurstaki başarın/başarısızlığın konusunda email yaz lütfen. Ayrıca eğer benimle telefonda görüşmek istersen ve danışmanlık almak istersen de yine email yolu ile bana ulaşman gerekiyor. Bu kursta benimle olduğun için teşekkür ederim. Aplikasyonda hatalar tespit ettiysen bunu belirtirsen sevineceğim. Görüşürüz...";
  } else if (completed <= 16) {
    imgSrc = '0003_dayanan.png';
    region = 'Dayanan Kişi';
    secondMessage = "Yine de seni tebrik ederim. İyi dayandın. Seninle bu görevlerde beraber olmak güzeldi. Umarım senin için de yararlı geçmiştir. Dayanan, kendini zorlayan bir yapın var. Şu anda usta konuma ulaşamamış olsan da çok iyi başarılar elde ettin. Benim tavsiyem eksiklik duyduğun konuların üzerine eğilmek için çaba göstermek, belki şimdi değil ama üzerinde biraz daha kafa patlatıp, tamamlayamadığın görevleri tamamlamak, hatta görevlerin hepsine yeniden başlamak ve yeni bir değerlendirme elde etmek ve en azından Usta Kişi kategorisini zorlamak. <br><br> Peki bundan sonra ne mi yapabilirsin? Eğer şu anda geldiğin seviyede başka bir görevi daha yapmak istemiyorum, artık buna vakit ayıramam, veya yapamıyorum, zorlanıyorum diyorsan o zaman bana bu kurs sırasında aldığın notları gönder ki bir değerlendirme yapayım. Bu kurs senin için bir KENDİNİ AÇIKLAMA VE HATALARI TESPİT kursu olsun. Eksiklerinin hangi alanda olduğunu, hangi alanda sosyal ihtiyaçlara sahip olduğunu, hangi alanlarda güçlü olduğunu tespit etmiş olduk. Bunları bana aktarırsan üzerinde yorumum olur ve sana özel bir değerlendirme yapmış olurum. Böylece öz güven konusunda daha bilinçli hareket etmiş olursun. Yapamadığın görevler için kendini cezalandırma. Dediğim gibi, bana yaz ve benden yorum bekle. Aşağıdaki linke tıkla ve bana bu kurstaki başarın/başarısızlığın konusunda email yaz lütfen. Ayrıca eğer benimle telefonda görüşmek istersen ve danışmanlık almak istersen de yine mail yolu ile bana ulaşman gerekiyor. Bu kursta benimle olduğun için teşekkür ederim. Aplikasyonda hatalar tespit ettiysen de yine yazmaktan çekinme..";
  } else {
    imgSrc = '0004_usta.png';
    region = 'Usta Kişi';
    secondMessage = "Bazı eksiklerin olsa da seni yaptığın özverili çalışmadan ötürü derinden kutlarım. Bu görevler sayesinde hayatında bir şeylerin değiştiğine eminim ve bunları MUTLAKA senden duymak isterim. <br><br> Peki bundan sonra ne mi yapabilirsin? Peki bundan sonra ne mi yapabilirsin? Eğer şu anda geldiğin seviyede başka bir görevi daha yapmak istemiyorum, artık buna vakit ayıramam, veya yapamıyorum, zorlanıyorum diyorsan o zaman bana bu kurs sırasında aldığın notları gönder ki bir değerlendirme yapayım. Bu kurs senin için bir KENDİNİ AÇIKLAMA VE HATALARI TESPİT kursu olsun. Eksiklerinin hangi alanda olduğunu, hangi alanda sosyal ihtiyaçlara sahip olduğunu, hangi alanlarda güçlü olduğunu tespit etmiş olduk. Bunları bana aktarırsan üzerinde yorumum olur ve sana özel bir değerlendirme yapmış olurum. Böylece öz güven konusunda daha bilinçli hareket etmiş olursun. Yapamadığın görevler için kendini cezalandırma. Dediğim gibi, bana yaz ve benden yorum bekle. Aşağıdaki linke tıkla ve bana bu kurstaki başarın/başarısızlığın konusunda email yaz lütfen. Ayrıca eğer benimle telefonda görüşmek istersen ve danışmanlık almak istersen de yine email yolu ile bana ulaşman gerekiyor. Bu kursta benimle olduğun için teşekkür ederim. Aplikasyonda hatalar tespit ettiysen de yine yazmaktan çekinme.";
  }

  if (completed === videos.length) {
    secondMessage = "Bu başarından ötürü seni tebrik etmek isterim. Zorlu saatlerdi değil mi? Ama buna değdi. Başarın hakkında diğer insanlara da yol göstermesi açısından ufak bir tanıklığını müsaade edersen internet sitemde kullanmak isterim. Lütfen bana yazar mısın? <br><br> Peki bundan sonra ne mi yapabilirsin? Aşağıdaki linke tıkla ve bana başarın konusunda email yaz lütfen. Bu kurs senin için bir KENDİNİ AÇIKLAMA VE HATALARI TESPİT kursu olsun. Eksiklerinin hangi alanda olduğunu, hangi alanda sosyal ihtiyaçlara sahip olduğunu, hangi alanlarda güçlü olduğunu tespit etmiş olduk. Bunları bana aktarırsan üzerinde yorumum olur ve sana özel bir değerlendirme yapmış olurum. Böylece öz güven konusunda daha bilinçli hareket etmiş olursun. Yapamadığın görevler için kendini cezalandırma. Dediğim gibi, bana yaz ve benden yorum bekle. Aşağıdaki linke tıkla ve bana bu kurstaki başarın/başarısızlığın konusunda email yaz lütfen. Ayrıca eğer benimle telefonda görüşmek istersen ve danışmanlık almak istersen de yine email yolu ile bana ulaşman gerekiyor. Bu kursta benimle olduğun için teşekkür ederim. Aplikasyonda hatalar tespit ettiysen de yine yazmaktan çekinme.";
  }

  openingMessage = `Toplam <strong>${completed}</strong> ders tamamlayarak <strong style="font-size: 1.8em; color: #5458a6; display: block; text-align: center; margin: 15px 0; padding: 10px; background: #f0f4ff; border-radius: 8px; border-left: 5px solid #5458a6;">${region}</strong> bölgesine eriştin. Kursa katıldığın ve kendini geliştirmek istediğin için teşekkür ederim. Umarım sana bir yararı olmuştur bu çalışmanın. Bu arada eksik olduğun noktalarda sana söyleyecek birkaç sözüm de var.`;

  // Find skipped lessons
   const skippedLessons = [];
  for (let i = 0; i < videos.length; i++) {
    if (savedData[i]?.skipped && !savedData[i]?.completed) {
      skippedLessons.push(i + 1); // Store lesson numbers (1-20)
    }
  }

  // Add skipped lesson assessment if any are CURRENTLY skipped
  let skippedAssessment = "";
  if (skippedLessons.length > 0) {
    // Find the lowest-numbered (least difficult) CURRENTLY skipped lesson
    const easiestSkipped = Math.min(...skippedLessons);
    
    // Get the assessment for this lesson
    const skippedAssessments = {
      1: "Hayalini hemen birine anlatmanı istemiştim. En azından bu görevi yapabilirdin. Bu görev, kalbinin en derin köşesinde sakladığın hayalini birine açmak, o hayali yüksek sesle dile getirerek gerçeğe bir adım daha yaklaşmakla ilgiliydi. Bunu yapsaydın, hayallerinin ne kadar güçlü olduğunu fark eder, yalnız hissetme duygusundan kurtulur ve hedeflerine ulaşmak için cesaret toplardın. Les Brown’un o harika sözüyle: “Çoğumuz hayallerimizi yaşamıyoruz çünkü korkularımızı yaşıyoruz.” Evet, hayallerin içinde dışarı çıkmayı bekliyor ve eğer sen bunları kimseye anlatmazsan, o hayallerin olmadığını düşünmeye başlayabilirsin. Öncelikle sana tavsiyem, hayallerini yüksek sesle kendine söyle. Kendinle konuş. Eğer yeterince konuşursan, başkasına anlatacak kadar cesaret toplayabilirsin. Çekinme. Umursama. Tepki vermelerini bekleme. Hayalini söyle ve geç. Belki de bunu söylediğin kişi negatif bir tepki verecek, belki seni anlamayacak. Ama sen kendi kendine şunu demiş olacaksın: Benim bir hayalim var ve bunu artık başkalarına, hayata, evrene, dışıma söyleyebiliyorum. Böylece o hayal benden çıkmış oluyor. Dışarıya çıkıyor. Aynen evlenmeyi düşünen birinin bunu dışarıdaki insanlara söylemeye başlaması gibi. Eğer söylemezsen, herkes bekar kalmak istediğini düşünebilir. Söylersen emin ol, sana evlenme adayı bakmaya başlayacaklar, yardım edeceklerdir. Çünkü Yaradan ancak isteklerini bilenlere yardım edebilir. Bunu açıklayanlara işaretini gösterir. Eğer bu hâlâ seni biraz ürkütüyorsa, işte bir ipucu: En güvendiğin bir arkadaşını ya da ailenden birini seç, belki bir kahve içerek sakin bir ortamda paylaş. Önce hayalini birkaç cümleyle yaz, böylece ne söyleyeceğini bilirsin ve konuşma doğal akar",
      2: "Korkunu seç, konuş ve paylaş demiştim. En azından bu görevi yapabilirdin. Bu görev, içindeki seni geri tutan bir korkuyu bulup bunu bir başkasıyla paylaşarak o yükü hafifletmekle ilgiliydi. Bunu başardığındaysa, korkuların seni daha az kontrol eder, yeni bir bakış açısıyla rahatlar ve birinin seni anlamasıyla güçlenirsin. İnsanların o banal ve sıkıcı konuşmalarının ötesine geçerdin. Dikkat ettin mi? Kimse korkularından söz etmiyor. Kimse hastalıklarından söz etmiyor, kimse içsel yaralarını dökmüyor birbirine. Güvenmiyoruz. Başkalarına korkularından söz etmek GÜVENMEK demektir. Evet, ilk güvenen sen ol. Ben ne zaman bunu yapsam, konuştuğum kişinin de aniden açıldığını ve kendi korkularını bana anlattığını görürüm. İlginç değil mi? Korkularından korkma. Korku paylaştıkça azalır. Tony Robbins’in dediği gibi, “Korkmamız gereken tek şey korkunun kendisi; adsız, nedensiz, haksız bir korku ki bu, geri çekilmeyi ilerlemeye dönüştürmek için gereken çabaları felce uğratır.” Hala zor mu geliyor? Şöyle yap: Büyük bir korku yerine küçük bir şey seç, mesela “yeni bir işe başlamaktan çekiniyorum” gibi. Bir yakın arkadaşına ya da çevrim-içi bir toplulukta anonim olarak paylaş, sadece içini dökmek bile büyük bir adım olacak!",
      3: "Olumlama yaparak sokakta hızlı adımlarla meditatif halde yürümeni istemiştim. En azından bu görevi yapabilirdin. Bu görev, sokakta kendinden emin adımlarla yürürken olumlu sözler söyleyerek zihnini güçlendirmek ve kalbinle ruhunu birleştirmekle ilgiliydi. Yapsaydın, kendini daha enerjik, zihnini daha berrak ve daha umutlu hissederdin. Louise Hay’in o güzel sözüyle, “Düşündüğümüz her düşünce geleceğimizi yaratıyor.” Fokus olduğun düşüncelere dikkat et. Genellikle aşağı çeken, negatif anlamda etki yapan daraltıcı fikirleri kafanda sürekli tekrarladığını göreceksin. Peki bunu değiştirmenin yolu nedir? Kendi kendine olumlu şeyler söylemek. Ama sana daha ilgincini söyleyeyim. Öncelikle kendinle KONUŞMAK çok önemli. Daha önce pek çok videomda belirttim. Kendinle konuş. Mutlaka yap bunu. Farklı bir insanla konuşuyormuş gibi kendine uzaktan bakmayı öğren. Göreceksin kendinle ilgili içgörüler kazanacaksın ve birisi sana sorduğu zaman SEN KİMSİN diye, verecek bir cevabın olacak. Kendini tanımalısın, yoksa hayatta başarıya ulaşamayacaksın. Ne istediğini, hangi fikirlere sahip olduğunu bil. Kendini baştan yarat. Eskimiş fikirlerini değiştir. Kendine el at. Bir ağabey bir abla gibi. Bak yanlış düşünüyorsun, de kendine. Eğer bu sana hâlâ zor geliyorsa, işte bir tüyo: Sessiz bir park ya da sakin bir sokak seç, cebine “Ben güçlüyüm” gibi basit bir olumlama yaz ve yürürken sessizce tekrarla. İlk gün sadece 5 dakika dene, farkı hissedeceksin.",
      4: "Bölgendeki kurslardan seçtiğin bir tanesine yazılmamı istemiştim. En azından bu görevi yapabilirdin. Bu görev, yerel belediye kurslarından birini seçip katılarak, yeni beceriler keşfetmek ve toplulukla bağ kurmakla ilgiliydi. Ödülleri arasında gizli yetenekleri keşfetmek, benzer düşünen insanlarla destek ağı kurmak ve yeni fırsatlar açabilecek pratik bilgiler edinmek yer alıyordu. Jim Rohn’un bilgece söylediği gibi, “Resmi eğitim size geçim sağlar; kendi kendine eğitim size servet kazandırır.” Bu görevi sana verme amacım gidip kursta müthiş bir gitarist veya kameraman olmayı öğrenmekten ziyade, odandan dışarı çıkmaya seni zorlamaktı. Bazı insanlar dışarı çıkıp da ne yapayım, enteresan bir şey mi var sanki, derler. Hayır, yaratmasını ve bulmasını bilene çok ilginç şeyler var dışarıda. Ben de hayatta öğrendiğim hemen hemen her şeyi kurslardan öğrendim. İnan bana hayat dönüştürücü olmasa bile, çok değerli bilgilere ulaşmanı sağlayacak, değişik insanlarla tanışma fırsatları yaratacak kurslara yazılabilirsin. Eğer bu görev hala zor geliyorsa, sana bir ipucu: Önce çevrim-içi olarak kursları araştırıp gerçekten seni heyecanlandıran birini seç, örneğin bir hobiyle ilgili bir sınıf, ve ilk derse bir arkadaşınızı davet ederek başlangıçtaki çekingenliği azalt.",
      5: "Kendin hakkında 10 sayfalık bir yazı yazmanı istemiştim. En azından bu görevi yapabilirdin. Bu görev, kendini başkahraman olarak zorlukları aşan bir kişi gibi gösterdiğin bir hikaye yazarak, yazıyı öz-yansıma ve kişisel kurtuluşu görselleştirme aracı olarak kullanmakla ilgiliydi. Tamamlasaydın, kendi yaşam mücadelelerine dair terapötik içgörüler kazanır, yaratıcılığını geliştirir ve engelleri geri dönüş için bir basamak olarak gören dirençli bir zihniyet oluştururdun. Brené Brown’un dediği gibi, “Hikayemize sahip çıkmak ve bu süreçte kendimizi sevmek, yapacağımız en cesur şeydir.” Evet kendi hikayemiz çok ama çok önemli ama biz hep dıştaki insanların hikayelerine odaklanıyoruz. Filmler seyredip romanlar okuyoruz. Neden? Çünkü diğer insanların hayatı çok ilgi çekici geliyor. Onlar zorlukları yaşamış, biz yaşamayalım, demek istiyoruz sanırım. Oysa kendi hayatının baş kahramanı olmazsan, herhangi bir konuda başarıya ulaşamazsın. Bencil ol, egoist narsist ol demiyorum. Ama kim olduğunu öğren, isteklerini öğren, hayat hikayeni öğren çünkü SENDEN BİR TANE DAHA YOK ve olmayacak. Eğer bu görev hala zor geliyorsa, sana bir ipucu: Yazıyı günlük parçalara böl, her gün bir sayfa yaz ve zaten aştığın gerçek bir geçmiş mücadele üzerinden yazarak hikayeyi otantik ve daha az korkutucu hale getir.",
      6: "Sokakta bir kişiyi durdurup konuşmanı istemiştim. En azından bu görevi yapabilirdin. Bu görev, bir yabancıyla basit bir soru sorarak spontane bağlantılar kurma sanatını uygulamakla ilgiliydi. Faydaları arasında sosyal kaygının azalması, iletişim becerilerinin keskinleşmesi ve farklı bakış açılarından beklenmedik içgörülerin sevinci yer alıyordu. İnsanlar bize özgürlük getirebilir. Hatta ben buna cidden inanıyorum. Özgürlük tek başına bir odada oturup kişisel gelişim kitapları okuyarak gelmiyor. Sokağa çıkarak geliyor. Mutlaka çıkın ve insanlara değer verin. Onların dinlenilmeye ihtiyacı var, konuşulmaya ihtiyacı var. Sana hiç oldu mu bilmiyorum ama, bana hep oluyor. Bana birisi yol sorduğu zaman hep durup kişinin arkasından acaba istediği lokasyona gitti mi diye bakakalırım. Neden? Çünkü insanların yardıma ihtiyaçları olduğunu bilirim. Onlar yardımımızı bekliyor. Konuşmadan yapamazsın bunu. Mutlaka konuşmayı öğren. Bunun için sokağa çıkmalısın. Eğer bu görev hala zor geliyorsa, sana bir ipucu: Nötr ve zararsız bir soru seç, örneğin yakındaki bir kafenin yolunu sor, bilsen bile, ve insanların daha rahat olduğu bir park gibi düşük baskılı bir ortamda yap.",
      7: "Bir yaşlı ile sohbet etmeni istemiştim. En azından bu görevi yapabilirdin. Bu görev, tanıdığın veya tanımadığın bir yaşlıya nezaket göstererek, sohbet, hizmet ve mizah yoluyla nesiller arası bağlar kurmak ve pozitiflik yaymakla ilgiliydi. Tamamladığındaysa, empatiyi zenginleştirir, minnettarlıkla dolu kalıcı anılar yaratır ve küçük merhamet eylemlerinin hem veren hem alan üzerindeki derin etkisini hatırlarsın. Maya Angelou’nun derin sözüyle, “İnsanlar ne söylediğinizi unutur, ne yaptığınızı unutur, ama onları nasıl hissettirdiğinizi asla unutmaz.” Bir gün sen de ihtiyar olacaksın, ve yalnız hissedeceksin. Ya seni de kimse dinlemese? Ya senin de yanına kimse gelmese nasıl olur? İşte bunu düşün. Sana bu görevi vermemin sebebi ihtiyar insanların en çok saygıya, en çok değere, en çok dinlenilmeye ihtiyacı olan insanlar olmasıdır. Eğer bu görev hala zor geliyorsa, sana bir ipucu: Tanıdık bir yaşlıyla, örneğin bir akraba veya komşuyla başla, önceden hafif bir fıkra veya hikaye hazırla ve market alışverişi gibi basit bir hizmet sunarak konuşmayı doğal bir şekilde uzat. Onlardan tavsiye almayı da sakın unutma",
      8: "Beş gün üst üste sabah yürüyüşü yapmanı istemiştim. En azından bu görevi yapabilirdin. Bu görev, düzenli erken sabah yürüyüşleriyle disiplin oluşturmak, sessiz şafak saatlerini yansıma ve canlılık için kullanmakla ilgiliydi. Avantajları arasında artan enerji seviyeleri, daha iyi uyku düzenleri ve gün boyunca üretkenliği besleyen bir başarı hissi yer alıyordu. Jocko Willink’in dediği gibi, “Disiplin özgürlüğe eşittir.” Bu görevi yapabilseydin, yapabildiğini görseydin, ufak adımlarla büyümenin ne olduğunu ve hayatın aslında bir büyüme yeri olduğunu anlardın. Ufak adımlar. Ufak başarılar. Gün be gün gerekiyor! Esaretin Bedeli filmindeki Andy Dufresne'nin kazdığı tünel gibi. Hayattan çıkış minimum değişimlerle gelecek. Eğer bu görev hala zor geliyorsa, sana bir ipucu: Alarmını motive edici bir çalma listesi veya podcast’le kur, yürüyüş kıyafetlerini akşamdan hazırla ve her yürüyüş sonrası kendini favori bir kahvaltıyla ödüllendirerek olumlu çağrışımlar oluştur.",
      9: "Alışveriş merkezine gidip bir görevli ile uzunca konuşmanı istemiştim. En azından bu görevi yapabilirdin. Bu görev, bir perakende çalışanıyla samimi bir kariyer konuşması yaparak, iş uygunluğu hakkında cesurca tavsiye istemekle ilgiliydi. Faydaları arasında gerçek dünya içgörüleri kazanmak, ağ kurma güvenini artırmak ve kendi kariyer hedeflerinizi netleştirmek yer alıyor. Konuşmak iyidir ve çok yakınımızda, samimi olmak isteyen, açılmak isteyen, ciddi gözükseler de günün sonunda İNSAN OLAN, senin benim gibi bir hayatı olan çok insan var biz onları görmezden geliyoruz. Hayır bunu yapma. Artık mağazalara girdiğin zaman HİKAYELERİ düşün. Acaba şu kasiyerin hayat hikayesi nasıl? Neye ihtiyaç duyuyor? Bunları açığa çıkartmak lazım. Böylece empati yeteneğin gelişecek ve kendi kabuğunun dışına çıkmış olacaksın. Eğer bu görev hala zor geliyorsa, sana bir ipucu: Yoğun olmayan saatlerde mağazayı ziyaret et, sorularını iş başvurusu yerine gerçek bir merak olarak çerçevele ve konuşmayı daha rahat yapmak için metni önceden sesli prova et.",
      10: "Kalabalıkta aniden durup kahkaha atmanı istemiştim. En azından bu görevi yapabilirdin. Bu görev, sahte bir telefon görüşmesiyle kendini bilinçli hissetmeyi kırarak, yüksek sesle kahkaha atarak halk içinde aptallığı kucaklamakla ilgiliydi. Özgürleşme, yargılanma korkusundan kurtulma, artan kendiliğindenlik ve hayata daha neşeli bir yaklaşım sunar. Kendini çok ciddiye alıyorsun. Bunu kırman gerekir. Hayat sandığın kadar ciddi ve karamsar bir yer değil. Bu görev bunu bulabilmen için bir fırsat sağlayacaktı. Eğer zamanın varsa mutlaka bu görevi yap. Eğer bu görev hala zor geliyorsa, sana bir ipucu: Alışveriş merkezi yemek alanı gibi kalabalık ama anonim bir yer seç, bir arkadaşın komik hikayesine tepki verdiğini hayal et ve daha yumuşak bir kahkahayla başlayarak yavaşça artır.",
      11: "Anne ve babanı arayıp teşekkür etmeni istemiştim. En azından bu görevi yapabilirdin. Bu görev, bir ebeveyne minnettarlık sözleriyle ulaşarak, kusurları kabul ederken onların hayatındaki rolünü onaylamakla ilgiliydi. Anne babamız bizlere ne kadar kötülük gibi gözüken şeyler yapmış olursa olsun, eğer şu anda nefes alıyorsak, yaşıyorsak, yine de onlara borçlu olduğumuzu unutmamalıyız. Bu yüzden onlarla barış içinde olmak, onların bedduasını almamak önemlidir. Derin faydaları arasında duygusal iyileşme, daha güçlü aile bağları ve zihinsel alanı serbest bırakan bastırılmış kızgınlıkların salıverilmesi yer alıyordu. Wayne Dyer’ın öğrettiği gibi, “Bir şeylere bakış açınızı değiştirdiğinizde, baktığınız şeyler değişir.” Eğer bu görev hala zor geliyorsa, sana bir ipucu: Tam sözleri önceden yaz ve gerekirse oku ve ezberle, sakin bir saatte ara ve duyguları kontrol altında tutmak için olumlu niyete odaklan.",
      12: "Küskün olduğun biriyle barışmanı istemiştim. En azından bu görevi yapabilirdin. Bu görev, uzun süredir konuşmadığımız biriyle asgari temas kurarak, ardından ortaya çıkan duyguları gözlemleyerek çözülmemiş sorunları işlemeyle ilgiliydi. Bu görev duygusal olgunluk ve ilişkileri onarma potansiyeli getirir. Şunu göreceksin, küstüğün kişinin O KADAR DA umrunda değilsin. Unutmuş gitmiş bile. Hatta sana diyecek ki “sorun neydi yahu hatırlayamadım.” Evet, cidden de insanlar unutuyorlar. Ama eğer sen unutmadı isen, bu duygusal yük seni aşağılara çeker. Bırak unutan sen ol. Bırak affeden sen ol, küçük düşen, küçük görünen sen ol. Hatta sana bir söz vereyim, af dilediğin için asla küçük düşmeyeceksin. Güçlü çıkacaksın. Brené Brown’un vurguladığı gibi, “Kırılganlık yenilik, yaratıcılık ve değişimin doğduğu yerdir.” Eğer bu görev hala zor geliyorsa, sana bir ipucu: Ayrılığın çok ciddi olmadığı birini seç, mesajı gönder ve hemen duygularını bir günlüğe yazarak dışa vur, cevapsız kalmanın bile geçmişle yüzleşmede ilerleme olduğunu hatırla.",
      13: "En azından bu görevi yapabilirdin. Bu görev, bir yayıneviyle bağlantı kurarak, anlaşma peşinde koşmadan rehberlik isteyerek edebi dünyada cesurca ağ kurmakla ilgiliydi. Faydaları arasında sektör bilgisi, yaratıcı olarak öz güven artışı ve profesyonel yazma hedeflerine yönelik adımlar yer alıyordu. Ayrıca üst düzey çalışan ve sektörde ve DÜNYADA fikir sahibi bazı insanlarla konuşmak, sizleri de onlar gibi ÇALIŞKAN bir enerjinin içine sokabilir, böylece etrafında seni aşağılara çeken, tembel, negatif insanların ağır yükünden kurtulmuş olursun. Arkadaşın neyle ilgileniyorsa sen de ona dönüşürsün. Eğer bu görev hala zor geliyorsa, sana bir ipucu: Yazı tarzın hakkında kısa bir tanıtım konuşması hazırla, daha sıcak bir karşılama için önce küçük bir bağımsız yayınevini ara ki bu yayınevleri aslında sizden kitabınızı basmanız için para isteyebilir. O yüzden kaybedecek bir şeyiniz yok aslında.",
      14: "Komşunla tanışmanı istemiştim. En azından bu görevi yapabilirdin. Bu görev, yakınımızdaki biriyle basit bir tanışma yaparak çevrenizde bir topluluk hissi oluşturmakla ilgiliydi. Daha güçlü yerel destek ağları, yalnızlık hissinin azalması ve günlük nezaket fırsatları sunar. Ben bu görevi yaptığımda yan komşuma annemin yaptığı aşureyi götürüp sunmuştum. Aşure haftası olmamasına rağmen kimsenin umrunda olmamıştı. Çok yakınımızda insanlar var ve biz onlardan bihaberiz, umursamıyoruz. Oysa sen umursadığınızı göster. İlk umursayan sen ol. Göreceksin bu çok farklı bir enerji getirecek. Dale Carnegie’nin tavsiyesiyle, “İki ayda, başkalarına ilgi göstererek, iki yılda başkalarını size ilgilendirmekten daha fazla arkadaş edinebilirsiniz.” Eğer bu görev hala zor geliyorsa, sana bir ipucu: Ortak bir bina sorunu hakkında sıradan bir başlangıç yap, kısa tut ve küçük bir jestle, örneğin bir tatlı paylaşarak devam et.",
      15: "Garsona para verip konuşmanı istemiştim. En azından bu görevi yapabilirdin. Bu görev, kişisel bir dokunuşla cömertlik uygulamak, bahşiş vermeden önce kısa bir konuşma yaparak vermeyi kendinden emin ifadeyle birleştirmekle ilgiliydi. Görevin sağlayacağı ödüller arasında gelişmiş empati, pozitiflik ve baskı altında iletişim becerilerinin büyümesi yer alıyordu. Veren el olmak mühimdir. Almaktan daha mühimdir. Vermeden alamazsın. Zig Ziglar’ın dediği gibi, “Başkalarının istediklerini almalarına yardım ederseniz, hayatta istediğiniz her şeye sahip olabilirsiniz.” Eğer bu görev hala zor geliyorsa, sana bir ipucu: “Bugün ki çalışmanız için teşekkür ederim” gibi basit, içten bir konuşma hazırla, kalabalıktan kaçınmak için sakin bir kafe seç ve miktarı önceden hesaplayarak ana odaklan.",
      16: "Sokaktan geçen 10 kişiye merhaba demeni istemiştim. Bu görevi zor görünse bile yapabilirdin. Bu görev, yabancılarla tekrarlanan selamlaşmalarla dostluk yayarak içe kapanıklığı sorgulamak ve açıklığı teşvik etmekle ilgiliydi. Sosyal rahatlık oluşturur, ruhunu yükselten olumlu tepkiler davet eder ve daha sevgi dolu bir dünya görüşü geliştirir. Aslında sokaktaki insanlar çok yakınımızda. Bunu diyerek ne demek istiyorum? Aslında yalnızlığı yenmek çok yakınımızda. Ama biz onu cep telefonlarımızda arıyoruz. Hayır! insanlar sokakta. İnsanların sana vereceği dönüştürücü güç, kendi kendine vereceğin ve yıllarca süren içsel arayışlardan daha hızlı enerji kazanmanı, öz güven kazanmanı sağlar. Mel Robbins’un teşvikiyle, “Tamamen farklı bir hayata sadece bir karar uzaktasınız.” Eğer bu görev hala zor geliyorsa, sana bir ipucu: Görevi insanların gelip geçtiği bir yürüyüş yolu gibi yüksek trafikli bir alanda yap, samimi bir gülümseme kullan ve ilerlemeyi takip etmek için zihinsel olarak say.",
      17: "Süpermarkette paraşüt araştırmanı istemiştim. Bu görevi yapabilirdin, evet zor ama imkansız değildi. Bu görev, mantıksız bir şey sorarak gariplik veya mizahi durumlarda dayanıklılık eğitimi almakla ilgiliydi. Bu görev, utanç karşısında kalın bir deri, daha keskin bir zeka ve normlardan bağımsız özgür bir ruh kazandırır. Ben bu görevi yaptığım zaman hiç kimsenin umurunda olmadığını, hatta bunu sorduğum insanların bana yardım etmek istediğini gördüm ve şaşırdım. Ne yani beni dövmeyecekler mi? Kaba konuşmayacaklar mı? Evet konuşmadılar. Bu görevi BEN size veriyorum çünkü ben uyguladım. Hemen bunu yapmalısın. Geç kalma. Özgürleştirici bir görevdir emin olabilirsin. (Hem biraz komiklik ve çılgınlık kime iyi gelmez ki?) Richard Branson’ın esprili sözüyle, “Biri size inanılmaz bir fırsat sunarsa ama yapabileceğinizden emin değilseniz, evet deyin — sonra nasıl yapacağınızı öğrenin!” Eğer bu görev hala zor geliyorsa, bir ipucu: “Paraşüt gibi maceracı bir şey arıyorum, bunları satıyor musunuz?” gibi şakacı bir çerçeve kullan, gülümse ve arkadaş canlısı görünen bir çalışanı seç.",
      18: "Beş gün telefonsuz yaşamanı istemiştim. Evet zor bir görev, ama bu görevi yapabilirdin. Bu görev, dijital detoks yaparak zihnimizin sürekli dikkat dağıtıcılar olmadan özgürce dolaşmasına izin vererek yaratıcılığı yeniden keşfetmekle ilgiliydi. Daha keskin odaklanma, yenilenmiş hayal gücü ve teknolojiyle daha sağlıklı bir denge sunar. Tim Ferriss’in not ettiği gibi, “Meşgul olmak bir tembellik şeklidir.” Şunu düşünebilirsin, daha önceden, mesela 1990'larda cep telefonu yoktu ve insanlar yaşamaya devam ediyorlardı. Nasıl oluyordu bu? Çünkü hayat o telefonlara bağlı değildir. Bunu zaten biliyorsun, ama bunu vücudunun da hissetmesi gerekiyor. Aynen yeniden yüzmeyi öğrenmek gibi. Hatta aslında yüzmeyi biliyorsun, tekrar hatırlat kendine. Ben yüzmeyi biliyorum. Korkma. Sen telefonsuz yaşamayı biliyorsun. Biliyordun. Ataların bunu biliyordu. Eğer bu görev hala zor geliyorsa, bir ipucu: Yakın çevreni çevrimdışı olacağın konusunda önceden bilgilendir, telefon zamanını bir not defteri veya kitapla değiştir ve her gün kısa çevrimdışı zamanlarla başlayarak ilerle.",
      19: "Noel baba şapkasıyla sokakta gezmeni istemiştim. Evet bazılarına çok zor gözükebilir ama senin gibi pek çok görevi tamamlamış bir kişinin bu konuyu başarmaması için bir sebep yoktu. Bu görev, mevsim dışı şenlikli kıyafetler giyerek yargı ortasında eğlenceyi kutlayarak uyumluluğa meydan okumakla ilgiliydi. Sarsılmaz öz güven, bulaşıcı neşe ve toplumsal beklentilerden kurtuluş kazandırır. Bunu yapabilmen için de özgün olman gerekir, aldırmaman gerekir. Bu yüzden herkese zor gelen şeyleri yapabilmen gerekir. Yoksa herkes gibi sen de konfor alanında kalır, oradan çıkmayı kafana koyamazsın. Cesur olmalısın. Dr. Seuss’un esprili tavsiyesiyle, “Neden uyum sağlayasın ki, sen farklı olmak için doğdun.” Eğer bu görev hala zor geliyorsa, bir ipucu: Bakkal alışverişi gibi kısa bir iş için giy, soru sorulursa tatil temalı bir şaka yap ve bunun geçici bir eğlence olduğunu söyle. Veya sadece arkadaşlarla iddiaya girdiğinden söz et.",
      20: "Farklı ayakkabılar ile alışveriş yapmanı istemiştim. Evet, bu en zor görev, ve bu görev kasıtlı olarak uyumsuz ayakkabılar giyerek cesurca normlara meydan okumak, bakışlara karşı özgünlüğünü test etmek ve güçlendirmekle ilgiliydi. İçsel gücün içsel mizahla alakası olduğunu düşünenlerdenim. Farklı ayakkabılar giyerek aslında insanların hiç de sizinle ilgilenmediklerini, dışlamadıklarını, merak dahi etmediklerini görebilirdin. Bunu ve buna benzer kendi kendini küçük düşürücü olan görevleri yaparsan, aslında KÜÇÜK DÜŞME eyleminin sadece kafanda olduğunu görürdün. Kimse seninle ilgilenmiyor veya küçük düşürmeye çalışmıyor, bunu yapan SENSİN. Kendi kendini utandıran, küçük gören sensin, başkası değil. Eleanor Roosevelt’in beyanıyla, “Kimse sizi rızanız olmadan aşağı hissettiremez.” Eğer bu görev hala zor geliyorsa, belki yapmak istersen diye bir ipucu: Farklı tarzda değil de, belki farklı renklerde ve bu renkler birbiri ile benzer olacak şekilde iki farklı ayakkabı giy, moral desteği için de güvendiğin bir arkadaşla git ve tepkileri sosyal bir deney olarak gözlemlemeye odaklanarak duygusal olarak konudan hiçbir şeyi üzerinize alınma."
    };

    skippedAssessment = `<div style="background: #CAD8E1; padding: 12px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
      <p style="font-size: 1.2em; margin: 0; color: #506266; line-height: 1.4;">
        <strong>Görev ${easiestSkipped} atlanmış:</strong> ${skippedAssessments[easiestSkipped]}
      </p>
    </div>`;
  }

  const contentHTML = `
 
<div class="assessment-image-container">
  <img src="${imgSrc}" alt="Milestone Image" style="transform: scale(1);">
</div>

<div class="assessment-content">
  <p style="font-size: 1.2em; margin: 0 0 12px 0; line-height: 1.4; color: #333;">${openingMessage}</p>
  ${skippedAssessment}
  <p style="font-size: 1.2em; margin: 0; line-height: 1.4; color: #555;">${secondMessage}</p>
  
  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 20px;">
    
    <span style="cursor: pointer; font-size: 1.8em; color: #5458a6; display: block; text-align: center; margin: 15px 0; padding: 10px; background: #ffc107; border-radius: 8px; border-left: 5px solid #5458a6;" onclick="shareResults()">Paylaş ➦</span>
  </div>
</div>

<div class="assessment-buttons">
  <button id="assessmentClose" style="background:#28a745; color:#fff; padding:12px 25px; border:none; font-family: Georgia, serif; border-radius:8px;">Kapat</button>
</div>
`;

  document.getElementById('assessmentDynamicContent').innerHTML = contentHTML;
// Add event listener to the close button after it's created
  setTimeout(() => {
    const closeButton = document.getElementById('assessmentClose');
    if (closeButton) {
      closeButton.addEventListener('click', () => {
        hidePopup('assessmentPopup');
      });
    }
  }, 100);
}



function openInYouTubeApp(videoId) {
  // Primary YouTube app URL (works for both Android and iOS)
  const youtubeAppUrl = `https://www.youtube.com/watch?v=${videoId}`;
  // Fallback web URL
  const webUrl = `https://www.youtube.com/watch?v=${videoId}`;

  // Try YouTube app URL first
  window.location.href = youtubeAppUrl;

  // Fallback to web after a short delay if app doesn't open
  setTimeout(() => {
    if (!document.hidden) {
      window.location.href = webUrl;
    }
  }, 500);

  // Show feedback
  showToast('YouTube uygulaması açılıyor...');
}


function resetLessons() {
  confirmAction = () => {
    hidePopup('assessmentPopup');
    
    // Store the permanent button state before clearing
    const shouldKeepButton = savedData.evalButtonPermanent;
    
    localStorage.removeItem("lessonData");
    savedData = {};
    savedData.confettiShown = false;
    
    // Restore the permanent button state if it was set
    if (shouldKeepButton) {
      savedData.evalButtonPermanent = true;
    }
    
    app.innerHTML = '';
    
    // Rebuild all lessons
    for (let i = 0; i < videos.length; i++) buildLesson(i);
    
    updateProgress();
    updateTopMessage(0);
    menuDropdown.style.display = 'none';
    
    // If the button should be permanent, show it again
    if (shouldKeepButton) {
      showEvaluationButton();
    }
    
    // Scroll to the first lesson
    const firstLesson = document.querySelector('.lesson[data-index="0"]');
    if (firstLesson) {
      setTimeout(() => {
        firstLesson.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Add highlight animation to the first lesson
        firstLesson.classList.add('new-lesson');
        setTimeout(() => firstLesson.classList.remove('new-lesson'), 1200);
      }, 300);
    }
    
    // Reset assessment viewed flag
    savedData.assessmentViewed = false;
    savedData.evalButtonShown = false;
    savedData.allHandledShown = false;
    saveData();
  };
  document.getElementById('confirmText').textContent = "Aldığın TÜM notlar silinecektir. Notlarını kopyalamanı öneririm. Tüm dersleri SIFIRLAMAK istediğine emin misin?";
  showPopup('confirmPopup');
}
// Initialize lessons and ensure evaluation button persists on load
for (let i = 0; i < videos.length; i++) buildLesson(i);
scrollToFirstUnfinishedLesson();
updateProgress();
updateTopMessage(0);




// Check if all tasks are completed or skipped
const allHandled = videos.length > 0 && 
                   Object.keys(savedData).length >= videos.length && 
                   Array.from({length: videos.length}, (_, i) => savedData[i] && (savedData[i].completed || savedData[i].skipped)).every(Boolean);

if (allHandled) {
  // Show the evaluation button if all tasks are handled
  showEvaluationButton();
  
  // Only show the popup if it hasn't been shown before
  if (!savedData.allHandledShown) {
    savedData.allHandledShown = true;
    saveData();
    showAllDonePopup();
  }
}

// ALSO show the button if the flag was set from a previous session
// This catches the case where the page is refreshed after the button was already shown
if (savedData.evalButtonShown) {
  showEvaluationButton();
}

function shareResults() {
  // Show the share options popup instead of directly sharing
  showPopup('sharePopup');
}

function getShareContent() {
  const completed = Object.values(savedData).filter(d => d.completed).length;
  const total = videos.length;
  let region, emoji;
  
  if (completed <= 4) {
    region = 'Emekleyen Kişi';
    emoji = '🐣';
  } else if (completed <= 9) {
    region = 'Kalkmaya Başlayan Kişi';
    emoji = '🚶';
  } else if (completed <= 16) {
    region = 'Dayanan Kişi';
    emoji = '💪';
  } else {
    region = 'Usta Kişi';
    emoji = '🏆';
  }

 // Create a list of all lessons with completion status
  let lessonsList = "";
  for (let i = 0; i < videos.length; i++) {
    const status = savedData[i]?.completed ? "✅" : (savedData[i]?.skipped ? "⏭️" : "❌");
    lessonsList += `${status} ${i+1}. ${titles[i]}\n`;
  }

  const baseText = `${emoji} Git Konuş! uygulamasında ${completed}/${total} görevi tamamlayarak "${region}" bölgesine ulaştım! 


--- TÜM GÖREVLER VE DURUMLARI ---
${lessonsList}
`;

  // Include both skipped and completed notes in order
  const allLessons = [];
  for (let i = 0; i < videos.length; i++) {
    const data = savedData[i] || {};
    const lessonNumber = i + 1;
    const lessonName = titles[i];
    let lessonText = '';

    // Add skipped note if it exists
    if (data.skipped && data.skipNote) {
      const skipNoteText = data.skipNote;
      const skipDate = data.skipDate ? data.skipDate : "--";
      lessonText = `⏭️ ATLANAN - ${lessonNumber}. ${lessonName}\nAtlanma Sebebi: ${skipNoteText}\nAtlanma Tarihi: ${skipDate}`;
    } else if (data.skipped) {
      const skipDate = data.skipDate ? formatDateToReadable(data.skipDate) : "--";
      lessonText = `⏭️ ATLANAN - ${lessonNumber}. ${lessonName}\nAtlanma Sebebi: Belirtilmemiş\nAtlanma Tarihi: ${skipDate}`;
    }

    // Add completed note if it exists
    if (data.completed && data.note) {
      if (lessonText) lessonText += '\n\n';
      const noteText = data.note;
      const editedDate = data.lastEdited ? formatDateToReadable(data.lastEdited) : "--";
      lessonText += `✅ TAMAMLANAN - ${lessonNumber}. ${lessonName}\n${noteText}\nSon Değiştirilme: ${editedDate}`;
    }

    if (lessonText) {
      allLessons.push(lessonText);
    }
  }

  const notes = allLessons.length ? allLessons.join('\n\n') : 'Henüz not yok.';
  const fullText = `${baseText}\n\n--- NOTLARIM ---\n${notes}`;

  return {
    baseText: baseText,
    fullText: fullText,
    subject: `Git Konuş! Başarım - ${region}`,
    completed: completed,
    total: total,
    region: region
  };
}


function shareViaEmail(recipient) {
  const content = getShareContent();
  let emailTo = '';
  let emailBody = '';
  
  if (recipient === 'orkun') {
    emailTo = 'orkunkumkale@yahoo.com';
    emailBody = `Merhaba Orkun,\n\n${content.fullText}\n\nSaygılarımla`;
  } else {
    // For self, we'll use mailto without specifying recipient
    emailBody = content.fullText;
  }
  
  const subject = encodeURIComponent(content.subject);
  const body = encodeURIComponent(emailBody);
  const mailtoUrl = recipient === 'orkun' 
    ? `mailto:${emailTo}?subject=${subject}&body=${body}`
    : `mailto:?subject=${subject}&body=${body}`;
  
  window.location.href = mailtoUrl;
  hidePopup('sharePopup');
  showToast('E-posta istemcisi açılıyor...');
}

function copyToClipboard() {
  const content = getShareContent();
  const temp = document.createElement('textarea');
  temp.value = content.fullText;
  document.body.appendChild(temp);
  temp.select();
  
  try {
    document.execCommand('copy');
    showToast('Başarım ve notlar panoya kopyalandı!');
  } catch (err) {
    showToast('Kopyalama hatası: ' + err);
  }
  
  document.body.removeChild(temp);
  hidePopup('sharePopup');
}

// NEW: Add Ben Kimim button functionality
document.getElementById('benKimimBtn').addEventListener('click', function() {
  showPopup('benKimimPopup');
});

// Ensure the benKimim popup is properly handled
document.getElementById("benKimimPopup").addEventListener("click", e => {
  if (e.target.id === "benKimimPopup") hidePopup('benKimimPopup');
});

function createConfetti(button) {
  const buttonRect = button.getBoundingClientRect();
  const buttonCenterX = buttonRect.left + buttonRect.width / 2;
  const buttonTop = buttonRect.top;
  const confettiContainer = document.createElement('div');
  confettiContainer.style.position = 'fixed';
  confettiContainer.style.top = '0';
  confettiContainer.style.left = '0';
  confettiContainer.style.width = '100%';
  confettiContainer.style.height = '100%';
  confettiContainer.style.pointerEvents = 'none';
  confettiContainer.style.zIndex = '9998';
  document.body.appendChild(confettiContainer);

  const confettiElements = [];
  const emojis = ['🎉', '⭐', '🎈', '🥳', '✨', '🏆'];

  for (let i = 0; i < 40; i++) {
    const confetti = document.createElement('div');
    confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    confetti.style.position = 'absolute';
    confetti.style.fontSize = Math.random() * 20 + 15 + 'px';
    confetti.style.zIndex = '9999';
    confetti.style.willChange = 'transform, opacity';
    
    // Initial position
    confetti.style.left = buttonCenterX + 'px';
    confetti.style.top = buttonTop + 'px';
    
    confettiContainer.appendChild(confetti);
    confettiElements.push(confetti);

    // Animate with requestAnimationFrame for better performance
    const startTime = Date.now();
    const duration = Math.random() * 2000 + 1500;
    const angle = Math.random() * Math.PI * 2;
    const distance = Math.random() * 120 + 80;
    const rotation = Math.random() * 360;

    function animate() {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      if (progress < 1) {
        const x = Math.cos(angle) * distance * progress;
        const y = Math.sin(angle) * distance * progress - 100 * progress * progress;
        const opacity = 1 - progress;
        
        confetti.style.transform = `translate(${x}px, ${y}px) rotate(${rotation * progress}deg)`;
        confetti.style.opacity = opacity;
        
        requestAnimationFrame(animate);
      } else {
        confettiContainer.removeChild(confetti);
        if (confettiContainer.children.length === 0) {
          document.body.removeChild(confettiContainer);
        }
      }
    }
    
    setTimeout(() => requestAnimationFrame(animate), i * 30);
  }
}

function calculateCompletionDays() {
  let firstDate = null;
  let lastDate = null;
  
  // Find the earliest and latest dates from all lessons
  for (let i = 0; i < videos.length; i++) {
    const data = savedData[i] || {};
    
    // Check completed lessons
    if (data.completed && data.lastEdited) {
      const date = new Date(data.lastEdited);
      if (!firstDate || date < firstDate) firstDate = date;
      if (!lastDate || date > lastDate) lastDate = date;
    }
    
    // Check skipped lessons
    if (data.skipped && data.skipDate) {
      const date = new Date(data.skipDate);
      if (!firstDate || date < firstDate) firstDate = date;
      if (!lastDate || date > lastDate) lastDate = date;
    }
  }
  
  // If we have both dates, calculate the difference in days
  if (firstDate && lastDate) {
    const timeDiff = Math.abs(lastDate.getTime() - firstDate.getTime());
    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
    return daysDiff;
  }
  
  return null;
}

function formatDateToReadable(dateString) {
  if (!dateString || dateString === "--") return "--";
  
  try {
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return dateString; // Return original if invalid date
    
    // Use Turkish locale for month names with 24-hour time format
    const datePart = date.toLocaleDateString('tr-TR', {
      day: '2-digit',
      month: 'short',
      year: 'numeric'
    });
    
    const timePart = date.toLocaleTimeString('tr-TR', {
      hour: '2-digit',
      minute: '2-digit',
      hour12: false // 24-hour format
    });
    
    return `${datePart} ${timePart}`;
  } catch (e) {
    return dateString; // Return original if error
  }
}

// Function to show the Ask Orkun popup
function showAskOrkunPopup() {
  // Reset the form
  document.getElementById('userName').value = '';
  document.getElementById('userSurname').value = '';
  document.getElementById('userAge').value = '';
  document.getElementById('askOrkunText').value = '';
  document.getElementById('shareNotesCheckbox').checked = false;
  
  // Reset gender radio buttons
  const genderRadios = document.querySelectorAll('input[name="userGender"]');
  genderRadios.forEach(radio => {
    radio.checked = false;
  });
  
  // Hide the share popup and show the ask popup
  hidePopup('sharePopup');
  showPopup('askOrkunPopup');
}
// Function to send the question to Orkun
function sendQuestionToOrkun() {
  const userName = document.getElementById('userName').value.trim();
  const userSurname = document.getElementById('userSurname').value.trim();
  const userAge = document.getElementById('userAge').value.trim();
 const userCity = document.getElementById('userCity').value.trim(); 
  const questionText = document.getElementById('askOrkunText').value.trim();
  const shareNotes = document.getElementById('shareNotesCheckbox').checked;
  
  // Get selected gender
  let userGender = '';
  const genderRadios = document.querySelectorAll('input[name="userGender"]');
  for (const radio of genderRadios) {
    if (radio.checked) {
      userGender = radio.value;
      break;
    }
  }
  
  // Validate required fields
if (!userName || !userSurname || !userAge || !userGender || !userCity) {
    showToast('Lütfen tüm kişisel bilgileri doldurun!');
    return;
  }
  
  if (!questionText) {
    showToast('Lütfen bir soru yazın!');
    return;
  }

  // === Add Base Progress Data ===
  const total = videos.length;
  const completed = Object.values(savedData).filter(d => d.completed).length;

  let region = "EMEKLEYEN";
  let emoji = "🐣";
  if (completed >= total * 0.85) { region = "USTA"; emoji = "🥇"; }
  else if (completed >= total * 0.5) { region = "DAYANAN"; emoji = "🥈"; }
  else if (completed >= total * 0.25) { region = "KALKMAYA BAŞLAYAN"; emoji = "🥉"; }

const completionDays = calculateCompletionDays();
const daysText = completionDays ? ` (Görevleri ${completionDays} günde tamamladım.)` : '';

const baseText = `${emoji} Git Konuş! uygulamasında ${completed}/${total} görevi tamamlayarak "${region}" bölgesine ulaştım!${daysText}`;

  // === Prepare email content ===
  let emailBody = baseText + "\n\n";   // Insert base data first
  
  
  emailBody += `Soru - Eleştiri - Teşekkür:\n\n`;
  emailBody += `${questionText}\n\n`;

 // === ADD ALL TASKS AND THEIR STATUSES ===
  emailBody += "== GÖREV DURUMLARI ==\n\n";
  
  for (let i = 0; i < videos.length; i++) {
    const data = savedData[i] || {};
    const status = data.completed ? "✅" : (data.skipped ? "❌" : "❌ YAPILMADI");
    emailBody += `${status} ${i + 1}. ${titles[i]} \n`;
    

  }
  
  emailBody += "  \n\n";

  // Add notes if requested
  if (shareNotes) {
    let allNotesText = "== GÖREV NOTLARI ==\n\n";
    const allLessons = [];
    for (let i = 0; i < videos.length; i++) {
      const data = savedData[i] || {};
      const lessonNumber = i + 1;
      const lessonName = titles[i];
      let lessonText = '';

      if (i > 0) {
        lessonText += "-----------------------------------\n\n";
      }

      if (data.skipped && data.skipNote) {
        const skipNoteText = data.skipNote;
        const skipDate = data.skipDate ? data.skipDate : "--";
        lessonText += `${lessonNumber}. ${lessonName}\n🔄 ${skipNoteText}\n ${skipDate}`;
      } else if (data.skipped) {
        const skipDate = data.skipDate ? data.skipDate : "--";
        lessonText += `${lessonNumber}. ${lessonName}\n🔄 Not Yok \n ${skipDate}`;
      }

      if (data.completed && data.note) {
        if (lessonText) lessonText += '\n\n';
        const noteText = data.note;
        const editedDate = data.lastEdited ? data.lastEdited : "--";
        lessonText += `${lessonNumber}. ${lessonName}\n ✅ ${noteText}\n ${editedDate}`;
      }

      if (lessonText) {
        allLessons.push(lessonText);
      }
    }

    allNotesText += allLessons.join("\n\n");
    if (!allLessons.length) {
      allNotesText += "Kopyalanacak not yok!\n\n";
    }

    const totalLessons = videos.length;
    const completedCount = Object.values(savedData).filter(d => d.completed).length;
    allNotesText += `\n\n==KURS ÖZETİ ==
Toplam Görev: ${totalLessons}
Tamamlanan: ${completedCount}\n`;

    const currentDate = new Date().toLocaleString('tr-TR');
    allNotesText += `Kopyalama: ${currentDate}\n\n`;

    emailBody += allNotesText;
  }
  
  // Create mailto link
  const subject = encodeURIComponent(`Git Konuş! - ${userName} ${userSurname} ${userAge} ${userGender} ${userCity}`);
  const body = encodeURIComponent(emailBody);
  const mailtoUrl = `mailto:orkunkumkale@yahoo.com?subject=${subject}&body=${body}`;

  
  // Open email client
  window.location.href = mailtoUrl;
  
  // Close the popup
  hidePopup('askOrkunPopup');
  
  // Show confirmation message
  showToast('E-posta istemciniz açılıyor...');
}
// Add event listeners when the document is loaded
document.addEventListener('DOMContentLoaded', function() {
  // Ask Orkun Send button
  document.getElementById('askOrkunSend')?.addEventListener('click', sendQuestionToOrkun);
  
  // Ask Orkun Cancel button
  document.getElementById('askOrkunCancel')?.addEventListener('click', function() {
    hidePopup('askOrkunPopup');
  });
  
  // Close popup when clicking outside
  document.getElementById('askOrkunPopup')?.addEventListener('click', function(e) {
    if (e.target.id === 'askOrkunPopup') {
      hidePopup('askOrkunPopup');
    }
  });
});

 const totalImages = 33;
  let currentIndex = 1;

  // adjust this if running inside Android WebView
  const basePath = "images/"; // e.g. "" if needed

  function updateImage() {
    const img = document.getElementById('galleryImage');
    img.src = `ovgu_(${currentIndex}).jpg`;
    document.getElementById('counter').textContent =
      `${currentIndex} / ${totalImages}`;
  }

  function nextImage() {
    currentIndex = (currentIndex % totalImages) + 1;
    updateImage();
  }

  function prevImage() {
    currentIndex = (currentIndex - 2 + totalImages) % totalImages + 1;
    updateImage();
  }

  // Call this when the popup opens
  function showGallery() {
    currentIndex = 1;
    updateImage();
    document.getElementById('benKimimPopup').style.display = 'block';
  }

  function hidePopup(id) {
    document.getElementById(id).style.display = 'none';
  }

  // OPTIONAL: preload first image when page loads
  document.addEventListener('DOMContentLoaded', updateImage);



</script>
<div class="popup" id="sharePopup">
  <div class="popup-content" style="max-width: 300px;">
    <h3 style="text-align: center; margin-bottom: 20px; color: #5458a6;">Paylaşım Seçenekleri</h3>
    
    <div style="display: flex; flex-direction: column; gap: 12px;">
      
      

      
<button class="share-option-btn" onclick="showAskOrkunPopup()">
  <span style="font-size: 1.2em; margin-right: 8px;"><img src="kucukorkun.png" alt="sorusormak" style="transform: scale(1);"></span> Orkun'a Sor
</button>
      
      <button class="share-option-btn" onclick="copyToClipboard()">
        <span style="font-size: 1.2em; margin-right: 8px;">📋</span> Notları Panoya Kopyala
      </button>
    </div>
    


    <button onclick="hidePopup('sharePopup')" 
            style="background: #dc3545; color: white; padding: 10px; border: none; border-radius: 6px; amargin-top: 20px; width: 100%;">
      İptal
    </button>
  </div>
</div>

<div id="passwordModal" style="
  position: fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.7); display:flex;
  justify-content:center; align-items:center; z-index:9999;">
  <div style="background:#000000; padding:10px 15px; border-radius:5px; text-align:center;">
    <h2>Şifre Girişi</h2>
    <input id="passwordInput" type="password" placeholder="Şifre" style="padding:8px;width:80%;margin:10px 0;">
    <br>
    <button id="submitPassword" style="padding:8px 16px;">Giriş</button>
    <p id="errorMsg" style="color:red;display:none;margin-top:10px;">Yanlış şifre!</p>
  </div>
</div>

</body>
</html>
